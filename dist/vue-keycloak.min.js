/**
  * vue-keycloak v0.0.11
  * (c) Cristian Baldi 2018
  */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.VueKeycloak=r()}(this,function(){"use strict";var e,r=(function(e){var r,n;r=window,n=function(e){if(!(this instanceof n))return new n(e);for(var t,o,s=this,i=[],c={enable:!0,callbackList:[],interval:5},a=document.getElementsByTagName("script"),u=0;u<a.length;u++)-1===a[u].src.indexOf("keycloak.js")&&-1===a[u].src.indexOf("keycloak.min.js")||-1===a[u].src.indexOf("version=")||(s.iframeVersion=a[u].src.substring(a[u].src.indexOf("version=")+8).split("&")[0]);function l(){return"/"==s.authServerUrl.charAt(s.authServerUrl.length-1)?s.authServerUrl+"realms/"+encodeURIComponent(s.realm):s.authServerUrl+"/realms/"+encodeURIComponent(s.realm)}function d(e,r){var n=e.code,t=e.error,o=e.prompt,i=(new Date).getTime();if(t)if("none"!=o){var c={error:t,error_description:e.error_description};s.onAuthError&&s.onAuthError(c),r&&r.setError(c)}else r&&r.setSuccess();else if("standard"!=s.flow&&(e.access_token||e.id_token)&&p(e.access_token,null,e.id_token,!0),"implicit"!=s.flow&&n){var a="code="+n+"&grant_type=authorization_code",u=l()+"/protocol/openid-connect/token",d=new XMLHttpRequest;d.open("POST",u,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.clientId&&s.clientSecret?d.setRequestHeader("Authorization","Basic "+btoa(s.clientId+":"+s.clientSecret)):a+="&client_id="+encodeURIComponent(s.clientId),a+="&redirect_uri="+e.redirectUri,d.withCredentials=!0,d.onreadystatechange=function(){if(4==d.readyState)if(200==d.status){var e=JSON.parse(d.responseText);p(e.access_token,e.refresh_token,e.id_token,"standard"===s.flow)}else s.onAuthError&&s.onAuthError(),r&&r.setError()},d.send(a)}function p(n,t,o,c){f(n,t,o,i=(i+(new Date).getTime())/2),s.tokenParsed&&s.tokenParsed.nonce!=e.storedNonce||s.refreshTokenParsed&&s.refreshTokenParsed.nonce!=e.storedNonce||s.idTokenParsed&&s.idTokenParsed.nonce!=e.storedNonce?(console.info("[KEYCLOAK] Invalid nonce, clearing token"),s.clearToken(),r&&r.setError()):c&&(s.onAuthSuccess&&s.onAuthSuccess(),r&&r.setSuccess())}}function f(e,r,n,t){if(s.tokenTimeoutHandle&&(clearTimeout(s.tokenTimeoutHandle),s.tokenTimeoutHandle=null),r?(s.refreshToken=r,s.refreshTokenParsed=p(r)):(delete s.refreshToken,delete s.refreshTokenParsed),n?(s.idToken=n,s.idTokenParsed=p(n)):(delete s.idToken,delete s.idTokenParsed),e){if(s.token=e,s.tokenParsed=p(e),s.sessionId=s.tokenParsed.session_state,s.authenticated=!0,s.subject=s.tokenParsed.sub,s.realmAccess=s.tokenParsed.realm_access,s.resourceAccess=s.tokenParsed.resource_access,t&&(s.timeSkew=Math.floor(t/1e3)-s.tokenParsed.iat),null!=s.timeSkew&&(console.info("[KEYCLOAK] Estimated time difference between browser and server is "+s.timeSkew+" seconds"),s.onTokenExpired)){var o=1e3*(s.tokenParsed.exp-(new Date).getTime()/1e3+s.timeSkew);console.info("[KEYCLOAK] Token expires in "+Math.round(o/1e3)+" s"),o<=0?s.onTokenExpired():s.tokenTimeoutHandle=setTimeout(s.onTokenExpired,o)}}else delete s.token,delete s.tokenParsed,delete s.subject,delete s.realmAccess,delete s.resourceAccess,s.authenticated=!1}function p(e){switch((e=(e=(e=e.split(".")[1]).replace("/-/g","+")).replace("/_/g","/")).length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Invalid token"}return e=(e=(e+"===").slice(0,e.length+e.length%4)).replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(escape(atob(e))),e=JSON.parse(e)}function m(){for(var e=[],r="0123456789abcdef",n=0;n<36;n++)e[n]=r.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=r.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function h(e){var r=new T(e,s.responseMode).parseUri(),n=o.get(r.state);if(n&&(r.code||r.error||r.access_token||r.id_token))return r.redirectUri=n.redirectUri,r.storedNonce=n.nonce,r.prompt=n.prompt,r.fragment&&(r.newUrl+="#"+r.fragment),r}function k(){var e={setSuccess:function(r){e.success=!0,e.result=r,e.successCallback&&e.successCallback(r)},setError:function(r){e.error=!0,e.result=r,e.errorCallback&&e.errorCallback(r)},promise:{success:function(r){return e.success?r(e.result):e.error||(e.successCallback=r),e.promise},error:function(r){return e.error?r(e.result):e.success||(e.errorCallback=r),e.promise}}};return e}function g(){var e=k();if(!c.enable)return e.setSuccess(),e.promise;if(c.iframe)return e.setSuccess(),e.promise;var n=document.createElement("iframe");c.iframe=n,n.onload=function(){var n=l();"/"===n.charAt(0)?c.iframeOrigin=r.location.origin?r.location.origin:r.location.protocol+"//"+r.location.hostname+(r.location.port?":"+r.location.port:""):c.iframeOrigin=n.substring(0,n.indexOf("/",8)),e.setSuccess(),setTimeout(o,1e3*c.interval)};var t=l()+"/protocol/openid-connect/login-status-iframe.html";s.iframeVersion&&(t=t+"?version="+s.iframeVersion),n.setAttribute("src",t),n.setAttribute("title","keycloak-session-iframe"),n.style.display="none",document.body.appendChild(n);r.addEventListener("message",function(e){if(e.origin===c.iframeOrigin&&c.iframe.contentWindow===e.source&&("unchanged"==e.data||"changed"==e.data||"error"==e.data)){"unchanged"!=e.data&&s.clearToken();for(var r=c.callbackList.splice(0,c.callbackList.length),n=r.length-1;n>=0;--n){var t=r[n];"unchanged"==e.data?t.setSuccess():t.setError()}}},!1);var o=function(){v(),s.token&&setTimeout(o,1e3*c.interval)};return e.promise}function v(){var e=k();if(c.iframe&&c.iframeOrigin){var r=s.clientId+" "+s.sessionId;c.callbackList.push(e);var n=c.iframeOrigin;1==c.callbackList.length&&c.iframe.contentWindow.postMessage(r,n)}else e.setSuccess();return e.promise}function S(e){if(!e||"default"==e)return{login:function(e){return r.location.href=s.createLoginUrl(e),k().promise},logout:function(e){return r.location.href=s.createLogoutUrl(e),k().promise},register:function(e){return r.location.href=s.createRegisterUrl(e),k().promise},accountManagement:function(){return r.location.href=s.createAccountUrl(),k().promise},redirectUri:function(e,r){if(1==arguments.length&&(r=!0),e&&e.redirectUri)return e.redirectUri;if(s.redirectUri)return s.redirectUri;var n=location.href;return location.hash&&r&&(n=n.substring(0,location.href.indexOf("#")),n+=(-1==n.indexOf("?")?"?":"&")+"redirect_fragment="+encodeURIComponent(location.hash.substring(1))),n}};if("cordova"==e){c.enable=!1;var n=function(e,n,t){return r.cordova&&r.cordova.InAppBrowser?r.cordova.InAppBrowser.open(e,n,t):r.open(e,n,t)};return{login:function(e){var r=k(),t="location=no";e&&"none"==e.prompt&&(t+=",hidden=yes");var o=s.createLoginUrl(e),i=n(o,"_blank",t),c=!1;return i.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&(d(h(e.url),r),i.close(),c=!0)}),i.addEventListener("loaderror",function(e){c||(0==e.url.indexOf("http://localhost")?(d(h(e.url),r),i.close(),c=!0):(r.setError(),i.close()))}),r.promise},logout:function(e){var r,t=k(),o=s.createLogoutUrl(e),i=n(o,"_blank","location=no,hidden=yes");return i.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&i.close()}),i.addEventListener("loaderror",function(e){0==e.url.indexOf("http://localhost")?i.close():(r=!0,i.close())}),i.addEventListener("exit",function(e){r?t.setError():(s.clearToken(),t.setSuccess())}),t.promise},register:function(){var e=s.createRegisterUrl(),r=n(e,"_blank","location=no");r.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&r.close()})},accountManagement:function(){var e=s.createAccountUrl(),r=n(e,"_blank","location=no");r.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&r.close()})},redirectUri:function(e){return"http://localhost"}}}throw"invalid adapter type: "+e}s.init=function(n){if(s.authenticated=!1,o=function(){try{return new w}catch(e){}return new b}(),t=n&&"cordova"===n.adapter?S("cordova"):n&&"default"===n.adapter?S():r.Cordova||r.cordova?S("cordova"):S(),n){if(void 0!==n.checkLoginIframe&&(c.enable=n.checkLoginIframe),n.checkLoginIframeInterval&&(c.interval=n.checkLoginIframeInterval),"login-required"===n.onLoad&&(s.loginRequired=!0),n.responseMode){if("query"!==n.responseMode&&"fragment"!==n.responseMode)throw"Invalid value for responseMode";s.responseMode=n.responseMode}if(n.flow){switch(n.flow){case"standard":s.responseType="code";break;case"implicit":s.responseType="id_token token";break;case"hybrid":s.responseType="code id_token token";break;default:throw"Invalid value for flow"}s.flow=n.flow}null!=n.timeSkew&&(s.timeSkew=n.timeSkew)}s.responseMode||(s.responseMode="fragment"),s.responseType||(s.responseType="code",s.flow="standard");var i=k(),a=k();a.promise.success(function(){s.onReady&&s.onReady(s.authenticated),i.setSuccess(s.authenticated)}).error(function(e){i.setError(e)});var u=function(r){var n,t=k();e?"string"==typeof e&&(n=e):n="keycloak.json";if(n){var o=new XMLHttpRequest;o.open("GET",n,!0),o.setRequestHeader("Accept","application/json"),o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status||0==(r=o).status&&r.responseText&&r.responseURL.startsWith("file:")){var e=JSON.parse(o.responseText);s.authServerUrl=e["auth-server-url"],s.realm=e.realm,s.clientId=e.resource,s.clientSecret=(e.credentials||{}).secret,t.setSuccess()}else t.setError();var r},o.send()}else{if(!e.url)for(var i=document.getElementsByTagName("script"),c=0;c<i.length;c++)if(i[c].src.match(/.*keycloak\.js/)){e.url=i[c].src.substr(0,i[c].src.indexOf("/js/keycloak.js"));break}if(!e.realm)throw"realm missing";if(!e.clientId)throw"clientId missing";s.authServerUrl=e.url,s.realm=e.realm,s.clientId=e.clientId,s.clientSecret=(e.credentials||{}).secret,t.setSuccess()}return t.promise}();function l(){var e=function(e){e||(r.prompt="none"),s.login(r).success(function(){a.setSuccess()}).error(function(){a.setError()})},r={};switch(n.onLoad){case"check-sso":c.enable?g().success(function(){v().success(function(){e(!1)}).error(function(){a.setSuccess()})}):e(!1);break;case"login-required":e(!0);break;default:throw"Invalid value for onLoad"}}return u.success(function(){var e=h(r.location.href);if(e)return g().success(function(){r.history.replaceState({},null,e.newUrl),d(e,a)}).error(function(e){a.setError()});n?n.token&&n.refreshToken?(f(n.token,n.refreshToken,n.idToken),c.enable?g().success(function(){v().success(function(){s.onAuthSuccess&&s.onAuthSuccess(),a.setSuccess()}).error(function(){f(null,null,null),a.setSuccess()})}):s.updateToken(-1).success(function(){s.onAuthSuccess&&s.onAuthSuccess(),a.setSuccess()}).error(function(){s.onAuthError&&s.onAuthError(),n.onLoad?l():a.setError()})):n.onLoad?l():a.setSuccess():a.setSuccess()}),u.error(function(){i.setError()}),i.promise},s.login=function(e){return t.login(e)},s.createLoginUrl=function(e){var r=m(),n=m(),i=t.redirectUri(e),c={state:r,nonce:n,redirectUri:encodeURIComponent(i)};e&&e.prompt&&(c.prompt=e.prompt),o.add(c);var a="auth";e&&"register"==e.action&&(a="registrations");var u=e&&e.scope?"openid "+e.scope:"openid",d=l()+"/protocol/openid-connect/"+a+"?client_id="+encodeURIComponent(s.clientId)+"&redirect_uri="+encodeURIComponent(i)+"&state="+encodeURIComponent(r)+"&nonce="+encodeURIComponent(n)+"&response_mode="+encodeURIComponent(s.responseMode)+"&response_type="+encodeURIComponent(s.responseType)+"&scope="+encodeURIComponent(u);return e&&e.prompt&&(d+="&prompt="+encodeURIComponent(e.prompt)),e&&e.maxAge&&(d+="&max_age="+encodeURIComponent(e.maxAge)),e&&e.loginHint&&(d+="&login_hint="+encodeURIComponent(e.loginHint)),e&&e.idpHint&&(d+="&kc_idp_hint="+encodeURIComponent(e.idpHint)),e&&e.locale&&(d+="&ui_locales="+encodeURIComponent(e.locale)),d},s.logout=function(e){return t.logout(e)},s.createLogoutUrl=function(e){return l()+"/protocol/openid-connect/logout?redirect_uri="+encodeURIComponent(t.redirectUri(e,!1))},s.register=function(e){return t.register(e)},s.createRegisterUrl=function(e){return e||(e={}),e.action="register",s.createLoginUrl(e)},s.createAccountUrl=function(e){return l()+"/account?referrer="+encodeURIComponent(s.clientId)+"&referrer_uri="+encodeURIComponent(t.redirectUri(e))},s.accountManagement=function(){return t.accountManagement()},s.hasRealmRole=function(e){var r=s.realmAccess;return!!r&&r.roles.indexOf(e)>=0},s.hasResourceRole=function(e,r){if(!s.resourceAccess)return!1;var n=s.resourceAccess[r||s.clientId];return!!n&&n.roles.indexOf(e)>=0},s.loadUserProfile=function(){var e=l()+"/account",r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+s.token);var n=k();return r.onreadystatechange=function(){4==r.readyState&&(200==r.status?(s.profile=JSON.parse(r.responseText),n.setSuccess(s.profile)):n.setError())},r.send(),n.promise},s.loadUserInfo=function(){var e=l()+"/protocol/openid-connect/userinfo",r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+s.token);var n=k();return r.onreadystatechange=function(){4==r.readyState&&(200==r.status?(s.userInfo=JSON.parse(r.responseText),n.setSuccess(s.userInfo)):n.setError())},r.send(),n.promise},s.isTokenExpired=function(e){if(!s.tokenParsed||!s.refreshToken&&"implicit"!=s.flow)throw"Not authenticated";if(null==s.timeSkew)return console.info("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var r=s.tokenParsed.exp-Math.ceil((new Date).getTime()/1e3)+s.timeSkew;return e&&(r-=e),r<0},s.updateToken=function(e){var r=k();if(!s.refreshToken)return r.setError(),r.promise;e=e||5;var n=function(){var n=!1;if(-1==e?(n=!0,console.info("[KEYCLOAK] Refreshing token: forced refresh")):s.tokenParsed&&!s.isTokenExpired(e)||(n=!0,console.info("[KEYCLOAK] Refreshing token: token expired")),n){var t="grant_type=refresh_token&refresh_token="+s.refreshToken,o=l()+"/protocol/openid-connect/token";if(i.push(r),1==i.length){var c=new XMLHttpRequest;c.open("POST",o,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.withCredentials=!0,s.clientId&&s.clientSecret?c.setRequestHeader("Authorization","Basic "+btoa(s.clientId+":"+s.clientSecret)):t+="&client_id="+encodeURIComponent(s.clientId);var a=(new Date).getTime();c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status){console.info("[KEYCLOAK] Token refreshed"),a=(a+(new Date).getTime())/2;var e=JSON.parse(c.responseText);f(e.access_token,e.refresh_token,e.id_token,a),s.onAuthRefreshSuccess&&s.onAuthRefreshSuccess();for(var r=i.pop();null!=r;r=i.pop())r.setSuccess(!0)}else{console.warn("[KEYCLOAK] Failed to refresh token"),s.onAuthRefreshError&&s.onAuthRefreshError();for(r=i.pop();null!=r;r=i.pop())r.setError(!0)}},c.send(t)}}else r.setSuccess(!1)};c.enable?v().success(function(){n()}).error(function(){r.setError()}):n();return r.promise},s.clearToken=function(){s.token&&(f(null,null,null),s.onAuthLogout&&s.onAuthLogout(),s.loginRequired&&s.login())},s.callback_id=0;var w=function(){if(!(this instanceof w))return new w;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");function e(){for(var e=(new Date).getTime(),r=0;r<localStorage.length;r++){var n=localStorage.key(r);if(n&&0==n.indexOf("kc-callback-")){var t=localStorage.getItem(n);if(t)try{var o=JSON.parse(t).expires;(!o||o<e)&&localStorage.removeItem(n)}catch(e){localStorage.removeItem(n)}}}}this.get=function(r){if(r){var n="kc-callback-"+r,t=localStorage.getItem(n);return t&&(localStorage.removeItem(n),t=JSON.parse(t)),e(),t}},this.add=function(r){e();var n="kc-callback-"+r.state;r.expires=(new Date).getTime()+36e5,localStorage.setItem(n,JSON.stringify(r))}},b=function(){if(!(this instanceof b))return new b;this.get=function(t){if(t){var o=r("kc-callback-"+t);return n("kc-callback-"+t,"",e(-100)),o?JSON.parse(o):void 0}},this.add=function(r){n("kc-callback-"+r.state,JSON.stringify(r),e(60))},this.removeItem=function(r){n(r,"",e(-100))};var e=function(e){var r=new Date;return r.setTime(r.getTime()+60*e*1e3),r},r=function(e){for(var r=e+"=",n=document.cookie.split(";"),t=0;t<n.length;t++){for(var o=n[t];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(r))return o.substring(r.length,o.length)}return""},n=function(e,r,n){var t=e+"="+r+"; expires="+n.toUTCString()+"; ";document.cookie=t}};var T=function(e,r){if(!(this instanceof T))return new T(e,r);var n=function(e){for(var r={},n=e.split("&"),t=0;t<n.length;t++){var o=n[t].split("="),s=decodeURIComponent(o[0]),i=decodeURIComponent(o[1]);r[s]=i}return r},t=function(e,r,n){for(var t=["code","state","error","error_description"],o=0;o<t.length;o++)if(e===t[o])return n[e]=r,!0;return!1};this.parseUri=function(){var o,s,i,c,a,u=(o=null,s=null,i=null,c=e.indexOf("?"),a=e.indexOf("#",c+1),-1==c&&-1==a?o=e:-1!=c?(o=e.substring(0,c),s=e.substring(c+1),-1!=a&&(a=s.indexOf("#"),i=s.substring(a+1),s=s.substring(0,a))):(o=e.substring(0,a),i=e.substring(a+1)),{baseUri:o,queryString:s,fragmentString:i}),l={};u.queryString&&(l=n(u.queryString));var d={newUrl:u.baseUri};for(var f in l)switch(f){case"redirect_fragment":d.fragment=l[f];break;default:"query"==r&&t(f,l[f],d)||(d.newUrl+=(-1==d.newUrl.indexOf("?")?"?":"&")+f+"="+encodeURIComponent(l[f]))}if("fragment"===r){var p={};for(var f in u.fragmentString&&(p=n(u.fragmentString)),p)d[f]=p[f]}return d}}},e?e.exports=n:r.Keycloak=n}(e={exports:{}},e.exports),e.exports),n=!1,t=function(){};return t.install=function(e,t){if(void 0===t&&(t={keycloakOptions:{},keycloakInitOptions:{},refreshTime:10}),!n){n=!0;var o=r(t.keycloakOptions),s=new e({data:function(){return{ready:!1,authenticated:!1,user:null,token:null,resourceAccess:null}}});o.init(t.keycloakInitOptions).success(function(e){i(e).then(function(){s.ready=!0}),e&&setTimeout(function(){o.updateToken(t.refreshTime+2).success(function(e){e&&i(!0)})},1e3*t.refreshTime)}),Object.defineProperty(e.prototype,"$keycloak",{get:function(){return o.ready=s.ready,o.user=s.user,o}})}function i(e){return void 0===e&&(e=!1),s.authenticated=e,e?(s.token=o.token,s.resourceAccess=o.resourceAccess,new Promise(function(e,r){o.loadUserProfile().success(function(r){s.user=r,e()})})):Promise.resolve()}},t.version="0.0.11",t});