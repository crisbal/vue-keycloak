/**
  * vue-keycloak v0.0.6
  * (c) Cristian Baldi 2017
  */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.VueKeycloak=r()}(this,function(){"use strict";var e=function(e,r){return r={exports:{}},e(r,r.exports),r.exports}(function(e){!function(r,n){var t=function(e){function n(){return"/"==S.authServerUrl.charAt(S.authServerUrl.length-1)?S.authServerUrl+"realms/"+encodeURIComponent(S.realm):S.authServerUrl+"/realms/"+encodeURIComponent(S.realm)}function o(){return r.location.origin?r.location.origin:r.location.protocol+"//"+r.location.hostname+(r.location.port?":"+r.location.port:"")}function s(e,r){function t(n,t,o,s){a(n,t,o,i=(i+(new Date).getTime())/2),S.tokenParsed&&S.tokenParsed.nonce!=e.storedNonce||S.refreshTokenParsed&&S.refreshTokenParsed.nonce!=e.storedNonce||S.idTokenParsed&&S.idTokenParsed.nonce!=e.storedNonce?(console.info("[KEYCLOAK] Invalid nonce, clearing token"),S.clearToken(),r&&r.setError()):s&&(S.onAuthSuccess&&S.onAuthSuccess(),r&&r.setSuccess())}var o=e.code,s=e.error,c=e.prompt,i=(new Date).getTime();if(s)if("none"!=c){var u={error:s,error_description:e.error_description};S.onAuthError&&S.onAuthError(u),r&&r.setError(u)}else r&&r.setSuccess();else if("standard"!=S.flow&&(e.access_token||e.id_token)&&t(e.access_token,null,e.id_token,!0),"implicit"!=S.flow&&o){var l="code="+o+"&grant_type=authorization_code",d=n()+"/protocol/openid-connect/token",f=new XMLHttpRequest;f.open("POST",d,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),S.clientId&&S.clientSecret?f.setRequestHeader("Authorization","Basic "+btoa(S.clientId+":"+S.clientSecret)):l+="&client_id="+encodeURIComponent(S.clientId),l+="&redirect_uri="+e.redirectUri,f.withCredentials=!0,f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status){var e=JSON.parse(f.responseText);t(e.access_token,e.refresh_token,e.id_token,"standard"===S.flow)}else S.onAuthError&&S.onAuthError(),r&&r.setError()},f.send(l)}}function c(r){var n,t=f();if(e?"string"==typeof e&&(n=e):n="keycloak.json",n){var o=new XMLHttpRequest;o.open("GET",n,!0),o.setRequestHeader("Accept","application/json"),o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status||i(o)){var e=JSON.parse(o.responseText);S.authServerUrl=e["auth-server-url"],S.realm=e.realm,S.clientId=e.resource,S.clientSecret=(e.credentials||{}).secret,t.setSuccess()}else t.setError()},o.send()}else{if(!e.url)for(var s=document.getElementsByTagName("script"),c=0;c<s.length;c++)if(s[c].src.match(/.*keycloak\.js/)){e.url=s[c].src.substr(0,s[c].src.indexOf("/js/keycloak.js"));break}if(!e.realm)throw"realm missing";if(!e.clientId)throw"clientId missing";S.authServerUrl=e.url,S.realm=e.realm,S.clientId=e.clientId,S.clientSecret=(e.credentials||{}).secret,t.setSuccess()}return t.promise}function i(e){return 0==e.status&&e.responseText&&e.responseURL.startsWith("file:")}function a(e,r,n,t){if(S.tokenTimeoutHandle&&(clearTimeout(S.tokenTimeoutHandle),S.tokenTimeoutHandle=null),r?(S.refreshToken=r,S.refreshTokenParsed=u(r)):(delete S.refreshToken,delete S.refreshTokenParsed),n?(S.idToken=n,S.idTokenParsed=u(n)):(delete S.idToken,delete S.idTokenParsed),e){if(S.token=e,S.tokenParsed=u(e),S.sessionId=S.tokenParsed.session_state,S.authenticated=!0,S.subject=S.tokenParsed.sub,S.realmAccess=S.tokenParsed.realm_access,S.resourceAccess=S.tokenParsed.resource_access,t&&(S.timeSkew=Math.floor(t/1e3)-S.tokenParsed.iat),null!=S.timeSkew&&(console.info("[KEYCLOAK] Estimated time difference between browser and server is "+S.timeSkew+" seconds"),S.onTokenExpired)){var o=1e3*(S.tokenParsed.exp-(new Date).getTime()/1e3+S.timeSkew);console.info("[KEYCLOAK] Token expires in "+Math.round(o/1e3)+" s"),o<=0?S.onTokenExpired():S.tokenTimeoutHandle=setTimeout(S.onTokenExpired,o)}}else delete S.token,delete S.tokenParsed,delete S.subject,delete S.realmAccess,delete S.resourceAccess,S.authenticated=!1}function u(e){switch(e=e.split(".")[1],e=e.replace("/-/g","+"),(e=e.replace("/_/g","/")).length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Invalid token"}return e=(e+"===").slice(0,e.length+e.length%4),e=e.replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(escape(atob(e))),e=JSON.parse(e)}function l(){for(var e=[],r=0;r<36;r++)e[r]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function d(e){var r=new I(e,S.responseMode).parseUri(),n=v.get(r.state);if(n&&(r.code||r.error||r.access_token||r.id_token))return r.redirectUri=n.redirectUri,r.storedNonce=n.nonce,r.prompt=n.prompt,r.fragment&&(r.newUrl+="#"+r.fragment),r}function f(){var e={setSuccess:function(r){e.success=!0,e.result=r,e.successCallback&&e.successCallback(r)},setError:function(r){e.error=!0,e.result=r,e.errorCallback&&e.errorCallback(r)},promise:{success:function(r){return e.success?r(e.result):e.error||(e.successCallback=r),e.promise},error:function(r){return e.error?r(e.result):e.success||(e.errorCallback=r),e.promise}}};return e}function p(){var e=f();if(!b.enable)return e.setSuccess(),e.promise;if(b.iframe)return e.setSuccess(),e.promise;var t=document.createElement("iframe");b.iframe=t,t.onload=function(){var r=n();"/"===r.charAt(0)?b.iframeOrigin=o():b.iframeOrigin=r.substring(0,r.indexOf("/",8)),e.setSuccess(),setTimeout(c,1e3*b.interval)};var s=n()+"/protocol/openid-connect/login-status-iframe.html";t.setAttribute("src",s),t.style.display="none",document.body.appendChild(t);r.addEventListener("message",function(e){if(e.origin===b.iframeOrigin&&b.iframe.contentWindow===e.source&&("unchanged"==e.data||"changed"==e.data||"error"==e.data)){"unchanged"!=e.data&&S.clearToken();for(var r=b.callbackList.splice(0,b.callbackList.length),n=r.length-1;n>=0;--n){var t=r[n];"unchanged"==e.data?t.setSuccess():t.setError()}}},!1);var c=function(){m(),S.token&&setTimeout(c,1e3*b.interval)};return e.promise}function m(){var e=f();if(b.iframe&&b.iframeOrigin){var r=S.clientId+" "+S.sessionId;b.callbackList.push(e);var n=b.iframeOrigin;1==b.callbackList.length&&b.iframe.contentWindow.postMessage(r,n)}else e.setSuccess();return e.promise}function h(e){if(!e||"default"==e)return{login:function(e){return r.location.href=S.createLoginUrl(e),f().promise},logout:function(e){return r.location.href=S.createLogoutUrl(e),f().promise},register:function(e){return r.location.href=S.createRegisterUrl(e),f().promise},accountManagement:function(){return r.location.href=S.createAccountUrl(),f().promise},redirectUri:function(e,r){if(1==arguments.length&&(r=!0),e&&e.redirectUri)return e.redirectUri;if(S.redirectUri)return S.redirectUri;var n=location.href;return location.hash&&r&&(n=n.substring(0,location.href.indexOf("#")),n+=(-1==n.indexOf("?")?"?":"&")+"redirect_fragment="+encodeURIComponent(location.hash.substring(1))),n}};if("cordova"==e)return b.enable=!1,{login:function(e){var n=f(),t="location=no";e&&"none"==e.prompt&&(t+=",hidden=yes");var o=S.createLoginUrl(e),c=r.open(o,"_blank",t),i=!1;return c.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&(s(d(e.url),n),c.close(),i=!0)}),c.addEventListener("loaderror",function(e){i||(0==e.url.indexOf("http://localhost")?(s(d(e.url),n),c.close(),i=!0):(n.setError(),c.close()))}),n.promise},logout:function(e){var n,t=f(),o=S.createLogoutUrl(e),s=r.open(o,"_blank","location=no,hidden=yes");return s.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&s.close()}),s.addEventListener("loaderror",function(e){0==e.url.indexOf("http://localhost")?s.close():(n=!0,s.close())}),s.addEventListener("exit",function(e){n?t.setError():(S.clearToken(),t.setSuccess())}),t.promise},register:function(){var e=S.createRegisterUrl(),n=r.open(e,"_blank","location=no");n.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&n.close()})},accountManagement:function(){var e=S.createAccountUrl(),n=r.open(e,"_blank","location=no");n.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&n.close()})},redirectUri:function(e){return"http://localhost"}};throw"invalid adapter type: "+e}function k(){try{return new T}catch(e){}return new U}if(!(this instanceof t))return new t(e);var g,v,S=this,w=[],b={enable:!0,callbackList:[],interval:5};S.init=function(e){function n(){var r=function(e){e||(n.prompt="none"),S.login(n).success(function(){o.setSuccess()}).error(function(){o.setError()})},n={};switch(e.onLoad){case"check-sso":b.enable?p().success(function(){m().success(function(){r(!1)}).error(function(){o.setSuccess()})}):r(!1);break;case"login-required":r(!0);break;default:throw"Invalid value for onLoad"}}if(S.authenticated=!1,v=k(),g=e&&"cordova"===e.adapter?h("cordova"):e&&"default"===e.adapter?h():r.Cordova?h("cordova"):h(),e){if(void 0!==e.checkLoginIframe&&(b.enable=e.checkLoginIframe),e.checkLoginIframeInterval&&(b.interval=e.checkLoginIframeInterval),"login-required"===e.onLoad&&(S.loginRequired=!0),e.responseMode){if("query"!==e.responseMode&&"fragment"!==e.responseMode)throw"Invalid value for responseMode";S.responseMode=e.responseMode}if(e.flow){switch(e.flow){case"standard":S.responseType="code";break;case"implicit":S.responseType="id_token token";break;case"hybrid":S.responseType="code id_token token";break;default:throw"Invalid value for flow"}S.flow=e.flow}null!=e.timeSkew&&(S.timeSkew=e.timeSkew)}S.responseMode||(S.responseMode="fragment"),S.responseType||(S.responseType="code",S.flow="standard");var t=f(),o=f();o.promise.success(function(){S.onReady&&S.onReady(S.authenticated),t.setSuccess(S.authenticated)}).error(function(e){t.setError(e)});var i=c();return i.success(function(){var t=d(r.location.href);if(t)return p(),r.history.replaceState({},null,t.newUrl),void s(t,o);e?e.token&&e.refreshToken?(a(e.token,e.refreshToken,e.idToken),b.enable?p().success(function(){m().success(function(){S.onAuthSuccess&&S.onAuthSuccess(),o.setSuccess()}).error(function(){a(null,null,null),o.setSuccess()})}):S.updateToken(-1).success(function(){S.onAuthSuccess&&S.onAuthSuccess(),o.setSuccess()}).error(function(){S.onAuthError&&S.onAuthError(),e.onLoad?n():o.setError()})):e.onLoad?n():o.setSuccess():o.setSuccess()}),i.error(function(){t.setError()}),t.promise},S.login=function(e){return g.login(e)},S.createLoginUrl=function(e){var r=l(),t=l(),o=g.redirectUri(e),s={state:r,nonce:t,redirectUri:encodeURIComponent(o)};e&&e.prompt&&(s.prompt=e.prompt),v.add(s);var c="auth";e&&"register"==e.action&&(c="registrations");var i=e&&e.scope?"openid "+e.scope:"openid",a=n()+"/protocol/openid-connect/"+c+"?client_id="+encodeURIComponent(S.clientId)+"&redirect_uri="+encodeURIComponent(o)+"&state="+encodeURIComponent(r)+"&nonce="+encodeURIComponent(t)+"&response_mode="+encodeURIComponent(S.responseMode)+"&response_type="+encodeURIComponent(S.responseType)+"&scope="+encodeURIComponent(i);return e&&e.prompt&&(a+="&prompt="+encodeURIComponent(e.prompt)),e&&e.maxAge&&(a+="&max_age="+encodeURIComponent(e.maxAge)),e&&e.loginHint&&(a+="&login_hint="+encodeURIComponent(e.loginHint)),e&&e.idpHint&&(a+="&kc_idp_hint="+encodeURIComponent(e.idpHint)),e&&e.locale&&(a+="&ui_locales="+encodeURIComponent(e.locale)),a},S.logout=function(e){return g.logout(e)},S.createLogoutUrl=function(e){return n()+"/protocol/openid-connect/logout?redirect_uri="+encodeURIComponent(g.redirectUri(e,!1))},S.register=function(e){return g.register(e)},S.createRegisterUrl=function(e){return e||(e={}),e.action="register",S.createLoginUrl(e)},S.createAccountUrl=function(e){return n()+"/account?referrer="+encodeURIComponent(S.clientId)+"&referrer_uri="+encodeURIComponent(g.redirectUri(e))},S.accountManagement=function(){return g.accountManagement()},S.hasRealmRole=function(e){var r=S.realmAccess;return!!r&&r.roles.indexOf(e)>=0},S.hasResourceRole=function(e,r){if(!S.resourceAccess)return!1;var n=S.resourceAccess[r||S.clientId];return!!n&&n.roles.indexOf(e)>=0},S.loadUserProfile=function(){var e=n()+"/account",r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+S.token);var t=f();return r.onreadystatechange=function(){4==r.readyState&&(200==r.status?(S.profile=JSON.parse(r.responseText),t.setSuccess(S.profile)):t.setError())},r.send(),t.promise},S.loadUserInfo=function(){var e=n()+"/protocol/openid-connect/userinfo",r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+S.token);var t=f();return r.onreadystatechange=function(){4==r.readyState&&(200==r.status?(S.userInfo=JSON.parse(r.responseText),t.setSuccess(S.userInfo)):t.setError())},r.send(),t.promise},S.isTokenExpired=function(e){if(!S.tokenParsed||!S.refreshToken&&"implicit"!=S.flow)throw"Not authenticated";if(null==S.timeSkew)return console.info("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var r=S.tokenParsed.exp-Math.ceil((new Date).getTime()/1e3)+S.timeSkew;return e&&(r-=e),r<0},S.updateToken=function(e){var r=f();if(!S.refreshToken)return r.setError(),r.promise;e=e||5;var t=function(){var t=!1;if(-1==e?(t=!0,console.info("[KEYCLOAK] Refreshing token: forced refresh")):S.tokenParsed&&!S.isTokenExpired(e)||(t=!0,console.info("[KEYCLOAK] Refreshing token: token expired")),t){var o="grant_type=refresh_token&refresh_token="+S.refreshToken,s=n()+"/protocol/openid-connect/token";if(w.push(r),1==w.length){var c=new XMLHttpRequest;c.open("POST",s,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.withCredentials=!0,S.clientId&&S.clientSecret?c.setRequestHeader("Authorization","Basic "+btoa(S.clientId+":"+S.clientSecret)):o+="&client_id="+encodeURIComponent(S.clientId);var i=(new Date).getTime();c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status){console.info("[KEYCLOAK] Token refreshed"),i=(i+(new Date).getTime())/2;var e=JSON.parse(c.responseText);a(e.access_token,e.refresh_token,e.id_token,i),S.onAuthRefreshSuccess&&S.onAuthRefreshSuccess();for(r=w.pop();null!=r;r=w.pop())r.setSuccess(!0)}else{console.warn("[KEYCLOAK] Failed to refresh token"),S.onAuthRefreshError&&S.onAuthRefreshError();for(var r=w.pop();null!=r;r=w.pop())r.setError(!0)}},c.send(o)}}else r.setSuccess(!1)};return b.enable?m().success(function(){t()}).error(function(){r.setError()}):t(),r.promise},S.clearToken=function(){S.token&&(a(null,null,null),S.onAuthLogout&&S.onAuthLogout(),S.loginRequired&&S.login())},S.callback_id=0;var T=function(){function e(){for(var e=(new Date).getTime(),r=0;r<localStorage.length;r++){var n=localStorage.key(r);if(n&&0==n.indexOf("kc-callback-")){var t=localStorage.getItem(n);if(t)try{var o=JSON.parse(t).expires;(!o||o<e)&&localStorage.removeItem(n)}catch(e){localStorage.removeItem(n)}}}}if(!(this instanceof T))return new T;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");var r=this;r.get=function(r){if(r){var n="kc-callback-"+r,t=localStorage.getItem(n);return t&&(localStorage.removeItem(n),t=JSON.parse(t)),e(),t}},r.add=function(r){e();var n="kc-callback-"+r.state;r.expires=(new Date).getTime()+36e5,localStorage.setItem(n,JSON.stringify(r))}},U=function(){if(!(this instanceof U))return new U;var e=this;e.get=function(e){if(e){var o=n("kc-callback-"+e);return t("kc-callback-"+e,"",r(-100)),o?JSON.parse(o):void 0}},e.add=function(e){t("kc-callback-"+e.state,JSON.stringify(e),r(60))},e.removeItem=function(e){t(e,"",r(-100))};var r=function(e){var r=new Date;return r.setTime(r.getTime()+60*e*1e3),r},n=function(e){for(var r=e+"=",n=document.cookie.split(";"),t=0;t<n.length;t++){for(var o=n[t];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(r))return o.substring(r.length,o.length)}return""},t=function(e,r,n){var t=e+"="+r+"; expires="+n.toUTCString()+"; ";document.cookie=t}},I=function(e,r){if(!(this instanceof I))return new I(e,r);var n=function(){var r=null,n=null,t=null,o=e.indexOf("?"),s=e.indexOf("#",o+1);return-1==o&&-1==s?r=e:-1!=o?(r=e.substring(0,o),n=e.substring(o+1),-1!=s&&(s=n.indexOf("#"),t=n.substring(s+1),n=n.substring(0,s))):(r=e.substring(0,s),t=e.substring(s+1)),{baseUri:r,queryString:n,fragmentString:t}},t=function(e){for(var r={},n=e.split("&"),t=0;t<n.length;t++){var o=n[t].split("="),s=decodeURIComponent(o[0]),c=decodeURIComponent(o[1]);r[s]=c}return r},o=function(e,r,n){for(var t=["code","state","error","error_description"],o=0;o<t.length;o++)if(e===t[o])return n[e]=r,!0;return!1};this.parseUri=function(){var e=n(),s={};e.queryString&&(s=t(e.queryString));var c={newUrl:e.baseUri};for(var i in s)switch(i){case"redirect_fragment":c.fragment=s[i];break;default:"query"==r&&o(i,s[i],c)||(c.newUrl+=(-1==c.newUrl.indexOf("?")?"?":"&")+i+"="+encodeURIComponent(s[i]))}if("fragment"===r){var a={};e.fragmentString&&(a=t(e.fragmentString));for(var i in a)c[i]=a[i]}return c}}};e?e.exports=t:r.Keycloak=t}(window)}),r=!1,n=function(){};return n.install=function(n,t){function o(e){void 0===e&&(e=!1),c.authenticated=e,e&&(c.token=s.token,c.resourceAccess=s.resourceAccess,s.loadUserProfile().success(function(e){c.user=e}))}if(void 0===t&&(t={keycloakOptions:{},keycloakInitOptions:{},refreshTime:10}),!r){r=!0;var s=e(t.keycloakOptions),c=new n({data:function(){return{ready:!1,authenticated:!1,user:null,token:null,resourceAccess:null}}});s.init(t.keycloakInitOptions).success(function(e){c.ready=!0,o(e),e&&setTimeout(function(){s.updateToken(t.refreshTime+2).success(function(e){e&&o(!0)})},1e3*t.refreshTime)}),Object.defineProperty(n.prototype,"$keycloak",{get:function(){return s.ready=c.ready,s.user=c.user,s}})}},n.version="0.0.6",n});