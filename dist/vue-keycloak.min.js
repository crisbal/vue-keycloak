/**
  * vue-keycloak v0.0.11
  * (c) Cristian Baldi 2018
  */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.VueKeycloak=r()}(this,function(){"use strict";var e,s=(function(e){var U,t;U=window,t=function(i){if(!(this instanceof t))return new t(i);for(var a,u,d=this,c=[],l={enable:!0,callbackList:[],interval:5},e=document.getElementsByTagName("script"),r=0;r<e.length;r++)-1===e[r].src.indexOf("keycloak.js")&&-1===e[r].src.indexOf("keycloak.min.js")||-1===e[r].src.indexOf("version=")||(d.iframeVersion=e[r].src.substring(e[r].src.indexOf("version=")+8).split("&")[0]);function f(){return"/"==d.authServerUrl.charAt(d.authServerUrl.length-1)?d.authServerUrl+"realms/"+encodeURIComponent(d.realm):d.authServerUrl+"/realms/"+encodeURIComponent(d.realm)}function p(o,s){var e=o.code,r=o.error,t=o.prompt,i=(new Date).getTime();if(r)if("none"!=t){var n={error:r,error_description:o.error_description};d.onAuthError&&d.onAuthError(n),s&&s.setError(n)}else s&&s.setSuccess();else if("standard"!=d.flow&&(o.access_token||o.id_token)&&l(o.access_token,null,o.id_token,!0),"implicit"!=d.flow&&e){var c="code="+e+"&grant_type=authorization_code",a=f()+"/protocol/openid-connect/token",u=new XMLHttpRequest;u.open("POST",a,!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.clientId&&d.clientSecret?u.setRequestHeader("Authorization","Basic "+btoa(d.clientId+":"+d.clientSecret)):c+="&client_id="+encodeURIComponent(d.clientId),c+="&redirect_uri="+o.redirectUri,u.withCredentials=!0,u.onreadystatechange=function(){if(4==u.readyState)if(200==u.status){var e=JSON.parse(u.responseText);l(e.access_token,e.refresh_token,e.id_token,"standard"===d.flow)}else d.onAuthError&&d.onAuthError(),s&&s.setError()},u.send(c)}function l(e,r,t,n){m(e,r,t,i=(i+(new Date).getTime())/2),d.tokenParsed&&d.tokenParsed.nonce!=o.storedNonce||d.refreshTokenParsed&&d.refreshTokenParsed.nonce!=o.storedNonce||d.idTokenParsed&&d.idTokenParsed.nonce!=o.storedNonce?(console.info("[KEYCLOAK] Invalid nonce, clearing token"),d.clearToken(),s&&s.setError()):n&&(d.onAuthSuccess&&d.onAuthSuccess(),s&&s.setSuccess())}}function m(e,r,t,n){if(d.tokenTimeoutHandle&&(clearTimeout(d.tokenTimeoutHandle),d.tokenTimeoutHandle=null),r?(d.refreshToken=r,d.refreshTokenParsed=s(r)):(delete d.refreshToken,delete d.refreshTokenParsed),t?(d.idToken=t,d.idTokenParsed=s(t)):(delete d.idToken,delete d.idTokenParsed),e){if(d.token=e,d.tokenParsed=s(e),d.sessionId=d.tokenParsed.session_state,d.authenticated=!0,d.subject=d.tokenParsed.sub,d.realmAccess=d.tokenParsed.realm_access,d.resourceAccess=d.tokenParsed.resource_access,n&&(d.timeSkew=Math.floor(n/1e3)-d.tokenParsed.iat),null!=d.timeSkew&&(console.info("[KEYCLOAK] Estimated time difference between browser and server is "+d.timeSkew+" seconds"),d.onTokenExpired)){var o=1e3*(d.tokenParsed.exp-(new Date).getTime()/1e3+d.timeSkew);console.info("[KEYCLOAK] Token expires in "+Math.round(o/1e3)+" s"),o<=0?d.onTokenExpired():d.tokenTimeoutHandle=setTimeout(d.onTokenExpired,o)}}else delete d.token,delete d.tokenParsed,delete d.subject,delete d.realmAccess,delete d.resourceAccess,d.authenticated=!1}function s(e){switch((e=(e=(e=e.split(".")[1]).replace("/-/g","+")).replace("/_/g","/")).length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Invalid token"}return e=(e=(e+"===").slice(0,e.length+e.length%4)).replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(escape(atob(e))),e=JSON.parse(e)}function h(){for(var e=[],r="0123456789abcdef",t=0;t<36;t++)e[t]=r.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=r.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function k(e){var r=new n(e,d.responseMode).parseUri(),t=u.get(r.state);if(t&&(r.code||r.error||r.access_token||r.id_token))return r.redirectUri=t.redirectUri,r.storedNonce=t.nonce,r.prompt=t.prompt,r.fragment&&(r.newUrl+="#"+r.fragment),r}function g(){var r={setSuccess:function(e){r.success=!0,r.result=e,r.successCallback&&r.successCallback(e)},setError:function(e){r.error=!0,r.result=e,r.errorCallback&&r.errorCallback(e)},promise:{success:function(e){return r.success?e(r.result):r.error||(r.successCallback=e),r.promise},error:function(e){return r.error?e(r.result):r.success||(r.errorCallback=e),r.promise}}};return r}function v(){var r=g();if(!l.enable)return r.setSuccess(),r.promise;if(l.iframe)return r.setSuccess(),r.promise;var e=document.createElement("iframe");(l.iframe=e).onload=function(){var e=f();"/"===e.charAt(0)?l.iframeOrigin=U.location.origin?U.location.origin:U.location.protocol+"//"+U.location.hostname+(U.location.port?":"+U.location.port:""):l.iframeOrigin=e.substring(0,e.indexOf("/",8)),r.setSuccess(),setTimeout(n,1e3*l.interval)};var t=f()+"/protocol/openid-connect/login-status-iframe.html";d.iframeVersion&&(t=t+"?version="+d.iframeVersion),e.setAttribute("src",t),e.setAttribute("title","keycloak-session-iframe"),e.style.display="none",document.body.appendChild(e);U.addEventListener("message",function(e){if(e.origin===l.iframeOrigin&&l.iframe.contentWindow===e.source&&("unchanged"==e.data||"changed"==e.data||"error"==e.data)){"unchanged"!=e.data&&d.clearToken();for(var r=l.callbackList.splice(0,l.callbackList.length),t=r.length-1;0<=t;--t){var n=r[t];"unchanged"==e.data?n.setSuccess():n.setError()}}},!1);var n=function(){S(),d.token&&setTimeout(n,1e3*l.interval)};return r.promise}function S(){var e=g();if(l.iframe&&l.iframeOrigin){var r=d.clientId+" "+d.sessionId;l.callbackList.push(e);var t=l.iframeOrigin;1==l.callbackList.length&&l.iframe.contentWindow.postMessage(r,t)}else e.setSuccess();return e.promise}function w(e){if(!e||"default"==e)return{login:function(e){return U.location.href=d.createLoginUrl(e),g().promise},logout:function(e){return U.location.href=d.createLogoutUrl(e),g().promise},register:function(e){return U.location.href=d.createRegisterUrl(e),g().promise},accountManagement:function(){return U.location.href=d.createAccountUrl(),g().promise},redirectUri:function(e,r){if(1==arguments.length&&(r=!0),e&&e.redirectUri)return e.redirectUri;if(d.redirectUri)return d.redirectUri;var t=location.href;return location.hash&&r&&(t=t.substring(0,location.href.indexOf("#")),t+=(-1==t.indexOf("?")?"?":"&")+"redirect_fragment="+encodeURIComponent(location.hash.substring(1))),t}};if("cordova"==e){l.enable=!1;var i=function(e,r,t){return U.cordova&&U.cordova.InAppBrowser?U.cordova.InAppBrowser.open(e,r,t):U.open(e,r,t)};return{login:function(e){var r=g(),t="location=no";e&&"none"==e.prompt&&(t+=",hidden=yes");var n=d.createLoginUrl(e),o=i(n,"_blank",t),s=!1;return o.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&(p(k(e.url),r),o.close(),s=!0)}),o.addEventListener("loaderror",function(e){s||(0==e.url.indexOf("http://localhost")?(p(k(e.url),r),o.close(),s=!0):(r.setError(),o.close()))}),r.promise},logout:function(e){var r,t=g(),n=d.createLogoutUrl(e),o=i(n,"_blank","location=no,hidden=yes");return o.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&o.close()}),o.addEventListener("loaderror",function(e){0==e.url.indexOf("http://localhost")||(r=!0),o.close()}),o.addEventListener("exit",function(e){r?t.setError():(d.clearToken(),t.setSuccess())}),t.promise},register:function(){var e=d.createRegisterUrl(),r=i(e,"_blank","location=no");r.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&r.close()})},accountManagement:function(){var e=d.createAccountUrl(),r=i(e,"_blank","location=no");r.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&r.close()})},redirectUri:function(e){return"http://localhost"}}}throw"invalid adapter type: "+e}d.init=function(t){if(d.authenticated=!1,u=function(){try{return new b}catch(e){}return new T}(),a=t&&"cordova"===t.adapter?w("cordova"):t&&"default"===t.adapter?w():U.Cordova||U.cordova?w("cordova"):w(),t){if(void 0!==t.checkLoginIframe&&(l.enable=t.checkLoginIframe),t.checkLoginIframeInterval&&(l.interval=t.checkLoginIframeInterval),"login-required"===t.onLoad&&(d.loginRequired=!0),t.responseMode){if("query"!==t.responseMode&&"fragment"!==t.responseMode)throw"Invalid value for responseMode";d.responseMode=t.responseMode}if(t.flow){switch(t.flow){case"standard":d.responseType="code";break;case"implicit":d.responseType="id_token token";break;case"hybrid":d.responseType="code id_token token";break;default:throw"Invalid value for flow"}d.flow=t.flow}null!=t.timeSkew&&(d.timeSkew=t.timeSkew)}d.responseMode||(d.responseMode="fragment"),d.responseType||(d.responseType="code",d.flow="standard");var r=g(),n=g();n.promise.success(function(){d.onReady&&d.onReady(d.authenticated),r.setSuccess(d.authenticated)}).error(function(e){r.setError(e)});var e=function(e){var r,t=g();i?"string"==typeof i&&(r=i):r="keycloak.json";if(r){var n=new XMLHttpRequest;n.open("GET",r,!0),n.setRequestHeader("Accept","application/json"),n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status||0==(r=n).status&&r.responseText&&r.responseURL.startsWith("file:")){var e=JSON.parse(n.responseText);d.authServerUrl=e["auth-server-url"],d.realm=e.realm,d.clientId=e.resource,d.clientSecret=(e.credentials||{}).secret,t.setSuccess()}else t.setError();var r},n.send()}else{if(!i.url)for(var o=document.getElementsByTagName("script"),s=0;s<o.length;s++)if(o[s].src.match(/.*keycloak\.js/)){i.url=o[s].src.substr(0,o[s].src.indexOf("/js/keycloak.js"));break}if(!i.realm)throw"realm missing";if(!i.clientId)throw"clientId missing";d.authServerUrl=i.url,d.realm=i.realm,d.clientId=i.clientId,d.clientSecret=(i.credentials||{}).secret,t.setSuccess()}return t.promise}();function o(){var e=function(e){e||(r.prompt="none"),d.login(r).success(function(){n.setSuccess()}).error(function(){n.setError()})},r={};switch(t.onLoad){case"check-sso":l.enable?v().success(function(){S().success(function(){e(!1)}).error(function(){n.setSuccess()})}):e(!1);break;case"login-required":e(!0);break;default:throw"Invalid value for onLoad"}}return e.success(function(){var e=k(U.location.href);if(e)return v().success(function(){U.history.replaceState({},null,e.newUrl),p(e,n)}).error(function(e){n.setError()});t?t.token&&t.refreshToken?(m(t.token,t.refreshToken,t.idToken),l.enable?v().success(function(){S().success(function(){d.onAuthSuccess&&d.onAuthSuccess(),n.setSuccess()}).error(function(){m(null,null,null),n.setSuccess()})}):d.updateToken(-1).success(function(){d.onAuthSuccess&&d.onAuthSuccess(),n.setSuccess()}).error(function(){d.onAuthError&&d.onAuthError(),t.onLoad?o():n.setError()})):t.onLoad?o():n.setSuccess():n.setSuccess()}),e.error(function(){r.setError()}),r.promise},d.login=function(e){return a.login(e)},d.createLoginUrl=function(e){var r=h(),t=h(),n=a.redirectUri(e),o={state:r,nonce:t,redirectUri:encodeURIComponent(n)};e&&e.prompt&&(o.prompt=e.prompt),u.add(o);var s="auth";e&&"register"==e.action&&(s="registrations");var i=e&&e.scope?"openid "+e.scope:"openid",c=f()+"/protocol/openid-connect/"+s+"?client_id="+encodeURIComponent(d.clientId)+"&redirect_uri="+encodeURIComponent(n)+"&state="+encodeURIComponent(r)+"&nonce="+encodeURIComponent(t)+"&response_mode="+encodeURIComponent(d.responseMode)+"&response_type="+encodeURIComponent(d.responseType)+"&scope="+encodeURIComponent(i);return e&&e.prompt&&(c+="&prompt="+encodeURIComponent(e.prompt)),e&&e.maxAge&&(c+="&max_age="+encodeURIComponent(e.maxAge)),e&&e.loginHint&&(c+="&login_hint="+encodeURIComponent(e.loginHint)),e&&e.idpHint&&(c+="&kc_idp_hint="+encodeURIComponent(e.idpHint)),e&&e.locale&&(c+="&ui_locales="+encodeURIComponent(e.locale)),c},d.logout=function(e){return a.logout(e)},d.createLogoutUrl=function(e){return f()+"/protocol/openid-connect/logout?redirect_uri="+encodeURIComponent(a.redirectUri(e,!1))},d.register=function(e){return a.register(e)},d.createRegisterUrl=function(e){return e||(e={}),e.action="register",d.createLoginUrl(e)},d.createAccountUrl=function(e){return f()+"/account?referrer="+encodeURIComponent(d.clientId)+"&referrer_uri="+encodeURIComponent(a.redirectUri(e))},d.accountManagement=function(){return a.accountManagement()},d.hasRealmRole=function(e){var r=d.realmAccess;return!!r&&0<=r.roles.indexOf(e)},d.hasResourceRole=function(e,r){if(!d.resourceAccess)return!1;var t=d.resourceAccess[r||d.clientId];return!!t&&0<=t.roles.indexOf(e)},d.loadUserProfile=function(){var e=f()+"/account",r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+d.token);var t=g();return r.onreadystatechange=function(){4==r.readyState&&(200==r.status?(d.profile=JSON.parse(r.responseText),t.setSuccess(d.profile)):t.setError())},r.send(),t.promise},d.loadUserInfo=function(){var e=f()+"/protocol/openid-connect/userinfo",r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+d.token);var t=g();return r.onreadystatechange=function(){4==r.readyState&&(200==r.status?(d.userInfo=JSON.parse(r.responseText),t.setSuccess(d.userInfo)):t.setError())},r.send(),t.promise},d.isTokenExpired=function(e){if(!d.tokenParsed||!d.refreshToken&&"implicit"!=d.flow)throw"Not authenticated";if(null==d.timeSkew)return console.info("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var r=d.tokenParsed.exp-Math.ceil((new Date).getTime()/1e3)+d.timeSkew;return e&&(r-=e),r<0},d.updateToken=function(s){var i=g();if(!d.refreshToken)return i.setError(),i.promise;s=s||5;var e=function(){var e=!1;if(-1==s?(e=!0,console.info("[KEYCLOAK] Refreshing token: forced refresh")):d.tokenParsed&&!d.isTokenExpired(s)||(e=!0,console.info("[KEYCLOAK] Refreshing token: token expired")),e){var r="grant_type=refresh_token&refresh_token="+d.refreshToken,t=f()+"/protocol/openid-connect/token";if(c.push(i),1==c.length){var n=new XMLHttpRequest;n.open("POST",t,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.withCredentials=!0,d.clientId&&d.clientSecret?n.setRequestHeader("Authorization","Basic "+btoa(d.clientId+":"+d.clientSecret)):r+="&client_id="+encodeURIComponent(d.clientId);var o=(new Date).getTime();n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status){console.info("[KEYCLOAK] Token refreshed"),o=(o+(new Date).getTime())/2;var e=JSON.parse(n.responseText);m(e.access_token,e.refresh_token,e.id_token,o),d.onAuthRefreshSuccess&&d.onAuthRefreshSuccess();for(var r=c.pop();null!=r;r=c.pop())r.setSuccess(!0)}else{console.warn("[KEYCLOAK] Failed to refresh token"),d.onAuthRefreshError&&d.onAuthRefreshError();for(r=c.pop();null!=r;r=c.pop())r.setError(!0)}},n.send(r)}}else i.setSuccess(!1)};l.enable?S().success(function(){e()}).error(function(){i.setError()}):e();return i.promise},d.clearToken=function(){d.token&&(m(null,null,null),d.onAuthLogout&&d.onAuthLogout(),d.loginRequired&&d.login())},d.callback_id=0;var b=function(){if(!(this instanceof b))return new b;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");function n(){for(var e=(new Date).getTime(),r=0;r<localStorage.length;r++){var t=localStorage.key(r);if(t&&0==t.indexOf("kc-callback-")){var n=localStorage.getItem(t);if(n)try{var o=JSON.parse(n).expires;(!o||o<e)&&localStorage.removeItem(t)}catch(e){localStorage.removeItem(t)}}}}this.get=function(e){if(e){var r="kc-callback-"+e,t=localStorage.getItem(r);return t&&(localStorage.removeItem(r),t=JSON.parse(t)),n(),t}},this.add=function(e){n();var r="kc-callback-"+e.state;e.expires=(new Date).getTime()+36e5,localStorage.setItem(r,JSON.stringify(e))}},T=function(){if(!(this instanceof T))return new T;this.get=function(e){if(e){var r=n("kc-callback-"+e);return o("kc-callback-"+e,"",t(-100)),r?JSON.parse(r):void 0}},this.add=function(e){o("kc-callback-"+e.state,JSON.stringify(e),t(60))},this.removeItem=function(e){o(e,"",t(-100))};var t=function(e){var r=new Date;return r.setTime(r.getTime()+60*e*1e3),r},n=function(e){for(var r=e+"=",t=document.cookie.split(";"),n=0;n<t.length;n++){for(var o=t[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(r))return o.substring(r.length,o.length)}return""},o=function(e,r,t){var n=e+"="+r+"; expires="+t.toUTCString()+"; ";document.cookie=n}};var n=function(l,d){if(!(this instanceof n))return new n(l,d);var f=function(e){for(var r={},t=e.split("&"),n=0;n<t.length;n++){var o=t[n].split("="),s=decodeURIComponent(o[0]),i=decodeURIComponent(o[1]);r[s]=i}return r},p=function(e,r,t){for(var n=["code","state","error","error_description"],o=0;o<n.length;o++)if(e===n[o])return t[e]=r,!0;return!1};this.parseUri=function(){var e,r,t,n,o,s=(t=r=e=null,n=l.indexOf("?"),o=l.indexOf("#",n+1),-1==n&&-1==o?e=l:-1!=n?(e=l.substring(0,n),r=l.substring(n+1),-1!=o&&(o=r.indexOf("#"),t=r.substring(o+1),r=r.substring(0,o))):(e=l.substring(0,o),t=l.substring(o+1)),{baseUri:e,queryString:r,fragmentString:t}),i={};s.queryString&&(i=f(s.queryString));var c={newUrl:s.baseUri};for(var a in i)switch(a){case"redirect_fragment":c.fragment=i[a];break;default:"query"==d&&p(a,i[a],c)||(c.newUrl+=(-1==c.newUrl.indexOf("?")?"?":"&")+a+"="+encodeURIComponent(i[a]))}if("fragment"===d){var u={};for(var a in s.fragmentString&&(u=f(s.fragmentString)),u)c[a]=u[a]}return c}}},e?e.exports=t:U.Keycloak=t}(e={exports:{}},e.exports),e.exports),i=!1,r=function(){};return r.install=function(e,r){if(void 0===r&&(r={keycloakOptions:{},keycloakInitOptions:{},refreshTime:10}),!i){i=!0;var t=s(r.keycloakOptions),n=new e({data:function(){return{ready:!1,authenticated:!1,user:null,token:null,resourceAccess:null}}});t.init(r.keycloakInitOptions).success(function(e){o(e).then(function(){n.ready=!0}),e&&setInterval(function(){t.updateToken(r.refreshTime+2).success(function(e){e&&o(!0)})},1e3*r.refreshTime)}),Object.defineProperty(e.prototype,"$keycloak",{get:function(){return t.ready=n.ready,t.user=n.user,t}})}function o(e){return void 0===e&&(e=!1),(n.authenticated=e)?(n.token=t.token,n.resourceAccess=t.resourceAccess,new Promise(function(r,e){t.loadUserProfile().success(function(e){n.user=e,r()})})):Promise.resolve()}},r.version="0.0.11",r});