/**
  * vue-keycloak v0.0.9
  * (c) Cristian Baldi 2018
  */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.VueKeycloak=r()}(this,function(){"use strict";var e,r=(function(e){var r,t;r=window,t=function(e){if(!(this instanceof t))return new t(e);for(var n,o,s=this,i=[],c={enable:!0,callbackList:[],interval:5},a=document.getElementsByTagName("script"),u=0;u<a.length;u++)-1===a[u].src.indexOf("keycloak.js")&&-1===a[u].src.indexOf("keycloak.min.js")||-1===a[u].src.indexOf("version=")||(s.iframeVersion=a[u].src.substring(a[u].src.indexOf("version=")+8).split("&")[0]);function l(){return"/"==s.authServerUrl.charAt(s.authServerUrl.length-1)?s.authServerUrl+"realms/"+encodeURIComponent(s.realm):s.authServerUrl+"/realms/"+encodeURIComponent(s.realm)}function d(e,r){var t=e.code,n=e.error,o=e.prompt,i=(new Date).getTime();if(n)if("none"!=o){var c={error:n,error_description:e.error_description};s.onAuthError&&s.onAuthError(c),r&&r.setError(c)}else r&&r.setSuccess();else if("standard"!=s.flow&&(e.access_token||e.id_token)&&p(e.access_token,null,e.id_token,!0),"implicit"!=s.flow&&t){var a="code="+t+"&grant_type=authorization_code",u=l()+"/protocol/openid-connect/token",d=new XMLHttpRequest;d.open("POST",u,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.clientId&&s.clientSecret?d.setRequestHeader("Authorization","Basic "+btoa(s.clientId+":"+s.clientSecret)):a+="&client_id="+encodeURIComponent(s.clientId),a+="&redirect_uri="+e.redirectUri,d.withCredentials=!0,d.onreadystatechange=function(){if(4==d.readyState)if(200==d.status){var e=JSON.parse(d.responseText);p(e.access_token,e.refresh_token,e.id_token,"standard"===s.flow)}else s.onAuthError&&s.onAuthError(),r&&r.setError()},d.send(a)}function p(t,n,o,c){f(t,n,o,i=(i+(new Date).getTime())/2),s.tokenParsed&&s.tokenParsed.nonce!=e.storedNonce||s.refreshTokenParsed&&s.refreshTokenParsed.nonce!=e.storedNonce||s.idTokenParsed&&s.idTokenParsed.nonce!=e.storedNonce?(console.info("[KEYCLOAK] Invalid nonce, clearing token"),s.clearToken(),r&&r.setError()):c&&(s.onAuthSuccess&&s.onAuthSuccess(),r&&r.setSuccess())}}function f(e,r,t,n){if(s.tokenTimeoutHandle&&(clearTimeout(s.tokenTimeoutHandle),s.tokenTimeoutHandle=null),r?(s.refreshToken=r,s.refreshTokenParsed=p(r)):(delete s.refreshToken,delete s.refreshTokenParsed),t?(s.idToken=t,s.idTokenParsed=p(t)):(delete s.idToken,delete s.idTokenParsed),e){if(s.token=e,s.tokenParsed=p(e),s.sessionId=s.tokenParsed.session_state,s.authenticated=!0,s.subject=s.tokenParsed.sub,s.realmAccess=s.tokenParsed.realm_access,s.resourceAccess=s.tokenParsed.resource_access,n&&(s.timeSkew=Math.floor(n/1e3)-s.tokenParsed.iat),null!=s.timeSkew&&(console.info("[KEYCLOAK] Estimated time difference between browser and server is "+s.timeSkew+" seconds"),s.onTokenExpired)){var o=1e3*(s.tokenParsed.exp-(new Date).getTime()/1e3+s.timeSkew);console.info("[KEYCLOAK] Token expires in "+Math.round(o/1e3)+" s"),o<=0?s.onTokenExpired():s.tokenTimeoutHandle=setTimeout(s.onTokenExpired,o)}}else delete s.token,delete s.tokenParsed,delete s.subject,delete s.realmAccess,delete s.resourceAccess,s.authenticated=!1}function p(e){switch((e=(e=(e=e.split(".")[1]).replace("/-/g","+")).replace("/_/g","/")).length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Invalid token"}return e=(e=(e+"===").slice(0,e.length+e.length%4)).replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(escape(atob(e))),e=JSON.parse(e)}function m(){for(var e=[],r="0123456789abcdef",t=0;t<36;t++)e[t]=r.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=r.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function h(e){var r=new T(e,s.responseMode).parseUri(),t=o.get(r.state);if(t&&(r.code||r.error||r.access_token||r.id_token))return r.redirectUri=t.redirectUri,r.storedNonce=t.nonce,r.prompt=t.prompt,r.fragment&&(r.newUrl+="#"+r.fragment),r}function k(){var e={setSuccess:function(r){e.success=!0,e.result=r,e.successCallback&&e.successCallback(r)},setError:function(r){e.error=!0,e.result=r,e.errorCallback&&e.errorCallback(r)},promise:{success:function(r){return e.success?r(e.result):e.error||(e.successCallback=r),e.promise},error:function(r){return e.error?r(e.result):e.success||(e.errorCallback=r),e.promise}}};return e}function g(){var e=k();if(!c.enable)return e.setSuccess(),e.promise;if(c.iframe)return e.setSuccess(),e.promise;var t=document.createElement("iframe");c.iframe=t,t.onload=function(){var t=l();"/"===t.charAt(0)?c.iframeOrigin=r.location.origin?r.location.origin:r.location.protocol+"//"+r.location.hostname+(r.location.port?":"+r.location.port:""):c.iframeOrigin=t.substring(0,t.indexOf("/",8)),e.setSuccess(),setTimeout(o,1e3*c.interval)};var n=l()+"/protocol/openid-connect/login-status-iframe.html";s.iframeVersion&&(n=n+"?version="+s.iframeVersion),t.setAttribute("src",n),t.setAttribute("title","keycloak-session-iframe"),t.style.display="none",document.body.appendChild(t);r.addEventListener("message",function(e){if(e.origin===c.iframeOrigin&&c.iframe.contentWindow===e.source&&("unchanged"==e.data||"changed"==e.data||"error"==e.data)){"unchanged"!=e.data&&s.clearToken();for(var r=c.callbackList.splice(0,c.callbackList.length),t=r.length-1;t>=0;--t){var n=r[t];"unchanged"==e.data?n.setSuccess():n.setError()}}},!1);var o=function(){v(),s.token&&setTimeout(o,1e3*c.interval)};return e.promise}function v(){var e=k();if(c.iframe&&c.iframeOrigin){var r=s.clientId+" "+s.sessionId;c.callbackList.push(e);var t=c.iframeOrigin;1==c.callbackList.length&&c.iframe.contentWindow.postMessage(r,t)}else e.setSuccess();return e.promise}function S(e){if(!e||"default"==e)return{login:function(e){return r.location.href=s.createLoginUrl(e),k().promise},logout:function(e){return r.location.href=s.createLogoutUrl(e),k().promise},register:function(e){return r.location.href=s.createRegisterUrl(e),k().promise},accountManagement:function(){return r.location.href=s.createAccountUrl(),k().promise},redirectUri:function(e,r){if(1==arguments.length&&(r=!0),e&&e.redirectUri)return e.redirectUri;if(s.redirectUri)return s.redirectUri;var t=location.href;return location.hash&&r&&(t=t.substring(0,location.href.indexOf("#")),t+=(-1==t.indexOf("?")?"?":"&")+"redirect_fragment="+encodeURIComponent(location.hash.substring(1))),t}};if("cordova"==e){c.enable=!1;var t=function(e,t,n){return r.cordova&&r.cordova.InAppBrowser?r.cordova.InAppBrowser.open(e,t,n):r.open(e,t,n)};return{login:function(e){var r=k(),n="location=no";e&&"none"==e.prompt&&(n+=",hidden=yes");var o=s.createLoginUrl(e),i=t(o,"_blank",n),c=!1;return i.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&(d(h(e.url),r),i.close(),c=!0)}),i.addEventListener("loaderror",function(e){c||(0==e.url.indexOf("http://localhost")?(d(h(e.url),r),i.close(),c=!0):(r.setError(),i.close()))}),r.promise},logout:function(e){var r,n=k(),o=s.createLogoutUrl(e),i=t(o,"_blank","location=no,hidden=yes");return i.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&i.close()}),i.addEventListener("loaderror",function(e){0==e.url.indexOf("http://localhost")?i.close():(r=!0,i.close())}),i.addEventListener("exit",function(e){r?n.setError():(s.clearToken(),n.setSuccess())}),n.promise},register:function(){var e=s.createRegisterUrl(),r=t(e,"_blank","location=no");r.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&r.close()})},accountManagement:function(){var e=s.createAccountUrl(),r=t(e,"_blank","location=no");r.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&r.close()})},redirectUri:function(e){return"http://localhost"}}}throw"invalid adapter type: "+e}s.init=function(t){if(s.authenticated=!1,o=function(){try{return new w}catch(e){}return new b}(),n=t&&"cordova"===t.adapter?S("cordova"):t&&"default"===t.adapter?S():r.Cordova||r.cordova?S("cordova"):S(),t){if(void 0!==t.checkLoginIframe&&(c.enable=t.checkLoginIframe),t.checkLoginIframeInterval&&(c.interval=t.checkLoginIframeInterval),"login-required"===t.onLoad&&(s.loginRequired=!0),t.responseMode){if("query"!==t.responseMode&&"fragment"!==t.responseMode)throw"Invalid value for responseMode";s.responseMode=t.responseMode}if(t.flow){switch(t.flow){case"standard":s.responseType="code";break;case"implicit":s.responseType="id_token token";break;case"hybrid":s.responseType="code id_token token";break;default:throw"Invalid value for flow"}s.flow=t.flow}null!=t.timeSkew&&(s.timeSkew=t.timeSkew)}s.responseMode||(s.responseMode="fragment"),s.responseType||(s.responseType="code",s.flow="standard");var i=k(),a=k();a.promise.success(function(){s.onReady&&s.onReady(s.authenticated),i.setSuccess(s.authenticated)}).error(function(e){i.setError(e)});var u=function(r){var t,n=k();e?"string"==typeof e&&(t=e):t="keycloak.json";if(t){var o=new XMLHttpRequest;o.open("GET",t,!0),o.setRequestHeader("Accept","application/json"),o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status||0==(r=o).status&&r.responseText&&r.responseURL.startsWith("file:")){var e=JSON.parse(o.responseText);s.authServerUrl=e["auth-server-url"],s.realm=e.realm,s.clientId=e.resource,s.clientSecret=(e.credentials||{}).secret,n.setSuccess()}else n.setError();var r},o.send()}else{if(!e.url)for(var i=document.getElementsByTagName("script"),c=0;c<i.length;c++)if(i[c].src.match(/.*keycloak\.js/)){e.url=i[c].src.substr(0,i[c].src.indexOf("/js/keycloak.js"));break}if(!e.realm)throw"realm missing";if(!e.clientId)throw"clientId missing";s.authServerUrl=e.url,s.realm=e.realm,s.clientId=e.clientId,s.clientSecret=(e.credentials||{}).secret,n.setSuccess()}return n.promise}();function l(){var e=function(e){e||(r.prompt="none"),s.login(r).success(function(){a.setSuccess()}).error(function(){a.setError()})},r={};switch(t.onLoad){case"check-sso":c.enable?g().success(function(){v().success(function(){e(!1)}).error(function(){a.setSuccess()})}):e(!1);break;case"login-required":e(!0);break;default:throw"Invalid value for onLoad"}}return u.success(function(){var e=h(r.location.href);if(e)return g().success(function(){r.history.replaceState({},null,e.newUrl),d(e,a)}).error(function(e){a.setError()});t?t.token&&t.refreshToken?(f(t.token,t.refreshToken,t.idToken),c.enable?g().success(function(){v().success(function(){s.onAuthSuccess&&s.onAuthSuccess(),a.setSuccess()}).error(function(){f(null,null,null),a.setSuccess()})}):s.updateToken(-1).success(function(){s.onAuthSuccess&&s.onAuthSuccess(),a.setSuccess()}).error(function(){s.onAuthError&&s.onAuthError(),t.onLoad?l():a.setError()})):t.onLoad?l():a.setSuccess():a.setSuccess()}),u.error(function(){i.setError()}),i.promise},s.login=function(e){return n.login(e)},s.createLoginUrl=function(e){var r=m(),t=m(),i=n.redirectUri(e),c={state:r,nonce:t,redirectUri:encodeURIComponent(i)};e&&e.prompt&&(c.prompt=e.prompt),o.add(c);var a="auth";e&&"register"==e.action&&(a="registrations");var u=e&&e.scope?"openid "+e.scope:"openid",d=l()+"/protocol/openid-connect/"+a+"?client_id="+encodeURIComponent(s.clientId)+"&redirect_uri="+encodeURIComponent(i)+"&state="+encodeURIComponent(r)+"&nonce="+encodeURIComponent(t)+"&response_mode="+encodeURIComponent(s.responseMode)+"&response_type="+encodeURIComponent(s.responseType)+"&scope="+encodeURIComponent(u);return e&&e.prompt&&(d+="&prompt="+encodeURIComponent(e.prompt)),e&&e.maxAge&&(d+="&max_age="+encodeURIComponent(e.maxAge)),e&&e.loginHint&&(d+="&login_hint="+encodeURIComponent(e.loginHint)),e&&e.idpHint&&(d+="&kc_idp_hint="+encodeURIComponent(e.idpHint)),e&&e.locale&&(d+="&ui_locales="+encodeURIComponent(e.locale)),d},s.logout=function(e){return n.logout(e)},s.createLogoutUrl=function(e){return l()+"/protocol/openid-connect/logout?redirect_uri="+encodeURIComponent(n.redirectUri(e,!1))},s.register=function(e){return n.register(e)},s.createRegisterUrl=function(e){return e||(e={}),e.action="register",s.createLoginUrl(e)},s.createAccountUrl=function(e){return l()+"/account?referrer="+encodeURIComponent(s.clientId)+"&referrer_uri="+encodeURIComponent(n.redirectUri(e))},s.accountManagement=function(){return n.accountManagement()},s.hasRealmRole=function(e){var r=s.realmAccess;return!!r&&r.roles.indexOf(e)>=0},s.hasResourceRole=function(e,r){if(!s.resourceAccess)return!1;var t=s.resourceAccess[r||s.clientId];return!!t&&t.roles.indexOf(e)>=0},s.loadUserProfile=function(){var e=l()+"/account",r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+s.token);var t=k();return r.onreadystatechange=function(){4==r.readyState&&(200==r.status?(s.profile=JSON.parse(r.responseText),t.setSuccess(s.profile)):t.setError())},r.send(),t.promise},s.loadUserInfo=function(){var e=l()+"/protocol/openid-connect/userinfo",r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+s.token);var t=k();return r.onreadystatechange=function(){4==r.readyState&&(200==r.status?(s.userInfo=JSON.parse(r.responseText),t.setSuccess(s.userInfo)):t.setError())},r.send(),t.promise},s.isTokenExpired=function(e){if(!s.tokenParsed||!s.refreshToken&&"implicit"!=s.flow)throw"Not authenticated";if(null==s.timeSkew)return console.info("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var r=s.tokenParsed.exp-Math.ceil((new Date).getTime()/1e3)+s.timeSkew;return e&&(r-=e),r<0},s.updateToken=function(e){var r=k();if(!s.refreshToken)return r.setError(),r.promise;e=e||5;var t=function(){var t=!1;if(-1==e?(t=!0,console.info("[KEYCLOAK] Refreshing token: forced refresh")):s.tokenParsed&&!s.isTokenExpired(e)||(t=!0,console.info("[KEYCLOAK] Refreshing token: token expired")),t){var n="grant_type=refresh_token&refresh_token="+s.refreshToken,o=l()+"/protocol/openid-connect/token";if(i.push(r),1==i.length){var c=new XMLHttpRequest;c.open("POST",o,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.withCredentials=!0,s.clientId&&s.clientSecret?c.setRequestHeader("Authorization","Basic "+btoa(s.clientId+":"+s.clientSecret)):n+="&client_id="+encodeURIComponent(s.clientId);var a=(new Date).getTime();c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status){console.info("[KEYCLOAK] Token refreshed"),a=(a+(new Date).getTime())/2;var e=JSON.parse(c.responseText);f(e.access_token,e.refresh_token,e.id_token,a),s.onAuthRefreshSuccess&&s.onAuthRefreshSuccess();for(var r=i.pop();null!=r;r=i.pop())r.setSuccess(!0)}else{console.warn("[KEYCLOAK] Failed to refresh token"),s.onAuthRefreshError&&s.onAuthRefreshError();for(r=i.pop();null!=r;r=i.pop())r.setError(!0)}},c.send(n)}}else r.setSuccess(!1)};c.enable?v().success(function(){t()}).error(function(){r.setError()}):t();return r.promise},s.clearToken=function(){s.token&&(f(null,null,null),s.onAuthLogout&&s.onAuthLogout(),s.loginRequired&&s.login())},s.callback_id=0;var w=function(){if(!(this instanceof w))return new w;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");function e(){for(var e=(new Date).getTime(),r=0;r<localStorage.length;r++){var t=localStorage.key(r);if(t&&0==t.indexOf("kc-callback-")){var n=localStorage.getItem(t);if(n)try{var o=JSON.parse(n).expires;(!o||o<e)&&localStorage.removeItem(t)}catch(e){localStorage.removeItem(t)}}}}this.get=function(r){if(r){var t="kc-callback-"+r,n=localStorage.getItem(t);return n&&(localStorage.removeItem(t),n=JSON.parse(n)),e(),n}},this.add=function(r){e();var t="kc-callback-"+r.state;r.expires=(new Date).getTime()+36e5,localStorage.setItem(t,JSON.stringify(r))}},b=function(){if(!(this instanceof b))return new b;this.get=function(n){if(n){var o=r("kc-callback-"+n);return t("kc-callback-"+n,"",e(-100)),o?JSON.parse(o):void 0}},this.add=function(r){t("kc-callback-"+r.state,JSON.stringify(r),e(60))},this.removeItem=function(r){t(r,"",e(-100))};var e=function(e){var r=new Date;return r.setTime(r.getTime()+60*e*1e3),r},r=function(e){for(var r=e+"=",t=document.cookie.split(";"),n=0;n<t.length;n++){for(var o=t[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(r))return o.substring(r.length,o.length)}return""},t=function(e,r,t){var n=e+"="+r+"; expires="+t.toUTCString()+"; ";document.cookie=n}};var T=function(e,r){if(!(this instanceof T))return new T(e,r);var t=function(e){for(var r={},t=e.split("&"),n=0;n<t.length;n++){var o=t[n].split("="),s=decodeURIComponent(o[0]),i=decodeURIComponent(o[1]);r[s]=i}return r},n=function(e,r,t){for(var n=["code","state","error","error_description"],o=0;o<n.length;o++)if(e===n[o])return t[e]=r,!0;return!1};this.parseUri=function(){var o,s,i,c,a,u=(o=null,s=null,i=null,c=e.indexOf("?"),a=e.indexOf("#",c+1),-1==c&&-1==a?o=e:-1!=c?(o=e.substring(0,c),s=e.substring(c+1),-1!=a&&(a=s.indexOf("#"),i=s.substring(a+1),s=s.substring(0,a))):(o=e.substring(0,a),i=e.substring(a+1)),{baseUri:o,queryString:s,fragmentString:i}),l={};u.queryString&&(l=t(u.queryString));var d={newUrl:u.baseUri};for(var f in l)switch(f){case"redirect_fragment":d.fragment=l[f];break;default:"query"==r&&n(f,l[f],d)||(d.newUrl+=(-1==d.newUrl.indexOf("?")?"?":"&")+f+"="+encodeURIComponent(l[f]))}if("fragment"===r){var p={};for(var f in u.fragmentString&&(p=t(u.fragmentString)),p)d[f]=p[f]}return d}}},e?e.exports=t:r.Keycloak=t}(e={exports:{}},e.exports),e.exports),t=!1,n=function(){};return n.install=function(e,n){if(void 0===n&&(n={keycloakOptions:{},keycloakInitOptions:{},refreshTime:10}),!t){t=!0;var o=r(n.keycloakOptions),s=new e({data:function(){return{ready:!1,authenticated:!1,user:null,token:null,resourceAccess:null}}});o.init(n.keycloakInitOptions).success(function(e){s.ready=!0,i(e),e&&setTimeout(function(){o.updateToken(n.refreshTime+2).success(function(e){e&&i(!0)})},1e3*n.refreshTime)}),Object.defineProperty(e.prototype,"$keycloak",{get:function(){return o.ready=s.ready,o.user=s.user,o}})}function i(e){void 0===e&&(e=!1),s.authenticated=e,e&&(s.token=o.token,s.resourceAccess=o.resourceAccess,o.loadUserProfile().success(function(e){s.user=e}))}},n.version="0.0.9",n});