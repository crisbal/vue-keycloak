/**
  * vue-keycloak v0.0.8
  * (c) Cristian Baldi 2017
  */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.VueKeycloak=r()}(this,function(){"use strict";var e=function(e,r){return r={exports:{}},e(r,r.exports),r.exports}(function(e){!function(r,n){var t=function(e){function n(){return"/"==h.authServerUrl.charAt(h.authServerUrl.length-1)?h.authServerUrl+"realms/"+encodeURIComponent(h.realm):h.authServerUrl+"/realms/"+encodeURIComponent(h.realm)}function o(e,r){function t(n,t,o,i){s(n,t,o,a=(a+(new Date).getTime())/2),h.tokenParsed&&h.tokenParsed.nonce!=e.storedNonce||h.refreshTokenParsed&&h.refreshTokenParsed.nonce!=e.storedNonce||h.idTokenParsed&&h.idTokenParsed.nonce!=e.storedNonce?(console.info("[KEYCLOAK] Invalid nonce, clearing token"),h.clearToken(),r&&r.setError()):i&&(h.onAuthSuccess&&h.onAuthSuccess(),r&&r.setSuccess())}var o=e.code,i=e.error,c=e.prompt,a=(new Date).getTime();if(i)if("none"!=c){var u={error:i,error_description:e.error_description};h.onAuthError&&h.onAuthError(u),r&&r.setError(u)}else r&&r.setSuccess();else if("standard"!=h.flow&&(e.access_token||e.id_token)&&t(e.access_token,null,e.id_token,!0),"implicit"!=h.flow&&o){var l="code="+o+"&grant_type=authorization_code",d=n()+"/protocol/openid-connect/token",f=new XMLHttpRequest;f.open("POST",d,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),h.clientId&&h.clientSecret?f.setRequestHeader("Authorization","Basic "+btoa(h.clientId+":"+h.clientSecret)):l+="&client_id="+encodeURIComponent(h.clientId),l+="&redirect_uri="+e.redirectUri,f.withCredentials=!0,f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status){var e=JSON.parse(f.responseText);t(e.access_token,e.refresh_token,e.id_token,"standard"===h.flow)}else h.onAuthError&&h.onAuthError(),r&&r.setError()},f.send(l)}}function s(e,r,n,t){if(h.tokenTimeoutHandle&&(clearTimeout(h.tokenTimeoutHandle),h.tokenTimeoutHandle=null),r?(h.refreshToken=r,h.refreshTokenParsed=i(r)):(delete h.refreshToken,delete h.refreshTokenParsed),n?(h.idToken=n,h.idTokenParsed=i(n)):(delete h.idToken,delete h.idTokenParsed),e){if(h.token=e,h.tokenParsed=i(e),h.sessionId=h.tokenParsed.session_state,h.authenticated=!0,h.subject=h.tokenParsed.sub,h.realmAccess=h.tokenParsed.realm_access,h.resourceAccess=h.tokenParsed.resource_access,t&&(h.timeSkew=Math.floor(t/1e3)-h.tokenParsed.iat),null!=h.timeSkew&&(console.info("[KEYCLOAK] Estimated time difference between browser and server is "+h.timeSkew+" seconds"),h.onTokenExpired)){var o=1e3*(h.tokenParsed.exp-(new Date).getTime()/1e3+h.timeSkew);console.info("[KEYCLOAK] Token expires in "+Math.round(o/1e3)+" s"),o<=0?h.onTokenExpired():h.tokenTimeoutHandle=setTimeout(h.onTokenExpired,o)}}else delete h.token,delete h.tokenParsed,delete h.subject,delete h.realmAccess,delete h.resourceAccess,h.authenticated=!1}function i(e){switch(e=e.split(".")[1],e=e.replace("/-/g","+"),(e=e.replace("/_/g","/")).length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Invalid token"}return e=(e+"===").slice(0,e.length+e.length%4),e=e.replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(escape(atob(e))),e=JSON.parse(e)}function c(){for(var e=[],r=0;r<36;r++)e[r]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";return e.join("")}function a(e){var r=new T(e,h.responseMode).parseUri(),n=m.get(r.state);if(n&&(r.code||r.error||r.access_token||r.id_token))return r.redirectUri=n.redirectUri,r.storedNonce=n.nonce,r.prompt=n.prompt,r.fragment&&(r.newUrl+="#"+r.fragment),r}function u(){var e={setSuccess:function(r){e.success=!0,e.result=r,e.successCallback&&e.successCallback(r)},setError:function(r){e.error=!0,e.result=r,e.errorCallback&&e.errorCallback(r)},promise:{success:function(r){return e.success?r(e.result):e.error||(e.successCallback=r),e.promise},error:function(r){return e.error?r(e.result):e.success||(e.errorCallback=r),e.promise}}};return e}function l(){var e=u();if(!g.enable)return e.setSuccess(),e.promise;if(g.iframe)return e.setSuccess(),e.promise;var t=document.createElement("iframe");g.iframe=t,t.onload=function(){var t=n();"/"===t.charAt(0)?g.iframeOrigin=r.location.origin?r.location.origin:r.location.protocol+"//"+r.location.hostname+(r.location.port?":"+r.location.port:""):g.iframeOrigin=t.substring(0,t.indexOf("/",8)),e.setSuccess(),setTimeout(s,1e3*g.interval)};var o=n()+"/protocol/openid-connect/login-status-iframe.html";h.iframeVersion&&(o=o+"?version="+h.iframeVersion),t.setAttribute("src",o),t.setAttribute("title","keycloak-session-iframe"),t.style.display="none",document.body.appendChild(t);r.addEventListener("message",function(e){if(e.origin===g.iframeOrigin&&g.iframe.contentWindow===e.source&&("unchanged"==e.data||"changed"==e.data||"error"==e.data)){"unchanged"!=e.data&&h.clearToken();for(var r=g.callbackList.splice(0,g.callbackList.length),n=r.length-1;n>=0;--n){var t=r[n];"unchanged"==e.data?t.setSuccess():t.setError()}}},!1);var s=function(){d(),h.token&&setTimeout(s,1e3*g.interval)};return e.promise}function d(){var e=u();if(g.iframe&&g.iframeOrigin){var r=h.clientId+" "+h.sessionId;g.callbackList.push(e);var n=g.iframeOrigin;1==g.callbackList.length&&g.iframe.contentWindow.postMessage(r,n)}else e.setSuccess();return e.promise}function f(e){if(!e||"default"==e)return{login:function(e){return r.location.href=h.createLoginUrl(e),u().promise},logout:function(e){return r.location.href=h.createLogoutUrl(e),u().promise},register:function(e){return r.location.href=h.createRegisterUrl(e),u().promise},accountManagement:function(){return r.location.href=h.createAccountUrl(),u().promise},redirectUri:function(e,r){if(1==arguments.length&&(r=!0),e&&e.redirectUri)return e.redirectUri;if(h.redirectUri)return h.redirectUri;var n=location.href;return location.hash&&r&&(n=n.substring(0,location.href.indexOf("#")),n+=(-1==n.indexOf("?")?"?":"&")+"redirect_fragment="+encodeURIComponent(location.hash.substring(1))),n}};if("cordova"==e){g.enable=!1;var n=function(e,n,t){return r.cordova&&r.cordova.InAppBrowser?r.cordova.InAppBrowser.open(e,n,t):r.open(e,n,t)};return{login:function(e){var r=u(),t="location=no";e&&"none"==e.prompt&&(t+=",hidden=yes");var s=h.createLoginUrl(e),i=n(s,"_blank",t),c=!1;return i.addEventListener("loadstart",function(e){if(0==e.url.indexOf("http://localhost")){o(a(e.url),r),i.close(),c=!0}}),i.addEventListener("loaderror",function(e){if(!c)if(0==e.url.indexOf("http://localhost")){o(a(e.url),r),i.close(),c=!0}else r.setError(),i.close()}),r.promise},logout:function(e){var r,t=u(),o=h.createLogoutUrl(e),s=n(o,"_blank","location=no,hidden=yes");return s.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&s.close()}),s.addEventListener("loaderror",function(e){0==e.url.indexOf("http://localhost")?s.close():(r=!0,s.close())}),s.addEventListener("exit",function(e){r?t.setError():(h.clearToken(),t.setSuccess())}),t.promise},register:function(){var e=h.createRegisterUrl(),r=n(e,"_blank","location=no");r.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&r.close()})},accountManagement:function(){var e=h.createAccountUrl(),r=n(e,"_blank","location=no");r.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&r.close()})},redirectUri:function(e){return"http://localhost"}}}throw"invalid adapter type: "+e}if(!(this instanceof t))return new t(e);for(var p,m,h=this,k=[],g={enable:!0,callbackList:[],interval:5},v=document.getElementsByTagName("script"),S=0;S<v.length;S++)-1===v[S].src.indexOf("keycloak.js")&&-1===v[S].src.indexOf("keycloak.min.js")||-1===v[S].src.indexOf("version=")||(h.iframeVersion=v[S].src.substring(v[S].src.indexOf("version=")+8).split("&")[0]);h.init=function(n){function t(){var e=function(e){e||(r.prompt="none"),h.login(r).success(function(){c.setSuccess()}).error(function(){c.setError()})},r={};switch(n.onLoad){case"check-sso":g.enable?l().success(function(){d().success(function(){e(!1)}).error(function(){c.setSuccess()})}):e(!1);break;case"login-required":e(!0);break;default:throw"Invalid value for onLoad"}}if(h.authenticated=!1,m=function(){try{return new w}catch(e){}return new b}(),p=n&&"cordova"===n.adapter?f("cordova"):n&&"default"===n.adapter?f():r.Cordova||r.cordova?f("cordova"):f(),n){if(void 0!==n.checkLoginIframe&&(g.enable=n.checkLoginIframe),n.checkLoginIframeInterval&&(g.interval=n.checkLoginIframeInterval),"login-required"===n.onLoad&&(h.loginRequired=!0),n.responseMode){if("query"!==n.responseMode&&"fragment"!==n.responseMode)throw"Invalid value for responseMode";h.responseMode=n.responseMode}if(n.flow){switch(n.flow){case"standard":h.responseType="code";break;case"implicit":h.responseType="id_token token";break;case"hybrid":h.responseType="code id_token token";break;default:throw"Invalid value for flow"}h.flow=n.flow}null!=n.timeSkew&&(h.timeSkew=n.timeSkew)}h.responseMode||(h.responseMode="fragment"),h.responseType||(h.responseType="code",h.flow="standard");var i=u(),c=u();c.promise.success(function(){h.onReady&&h.onReady(h.authenticated),i.setSuccess(h.authenticated)}).error(function(e){i.setError(e)});var k=function(r){var n,t=u();if(e?"string"==typeof e&&(n=e):n="keycloak.json",n){var o=new XMLHttpRequest;o.open("GET",n,!0),o.setRequestHeader("Accept","application/json"),o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status||function(e){return 0==e.status&&e.responseText&&e.responseURL.startsWith("file:")}(o)){var e=JSON.parse(o.responseText);h.authServerUrl=e["auth-server-url"],h.realm=e.realm,h.clientId=e.resource,h.clientSecret=(e.credentials||{}).secret,t.setSuccess()}else t.setError()},o.send()}else{if(!e.url)for(var s=document.getElementsByTagName("script"),i=0;i<s.length;i++)if(s[i].src.match(/.*keycloak\.js/)){e.url=s[i].src.substr(0,s[i].src.indexOf("/js/keycloak.js"));break}if(!e.realm)throw"realm missing";if(!e.clientId)throw"clientId missing";h.authServerUrl=e.url,h.realm=e.realm,h.clientId=e.clientId,h.clientSecret=(e.credentials||{}).secret,t.setSuccess()}return t.promise}();return k.success(function(){var e=a(r.location.href);if(e)return l(),r.history.replaceState({},null,e.newUrl),void o(e,c);n?n.token&&n.refreshToken?(s(n.token,n.refreshToken,n.idToken),g.enable?l().success(function(){d().success(function(){h.onAuthSuccess&&h.onAuthSuccess(),c.setSuccess()}).error(function(){s(null,null,null),c.setSuccess()})}):h.updateToken(-1).success(function(){h.onAuthSuccess&&h.onAuthSuccess(),c.setSuccess()}).error(function(){h.onAuthError&&h.onAuthError(),n.onLoad?t():c.setError()})):n.onLoad?t():c.setSuccess():c.setSuccess()}),k.error(function(){i.setError()}),i.promise},h.login=function(e){return p.login(e)},h.createLoginUrl=function(e){var r=c(),t=c(),o=p.redirectUri(e),s={state:r,nonce:t,redirectUri:encodeURIComponent(o)};e&&e.prompt&&(s.prompt=e.prompt),m.add(s);var i="auth";e&&"register"==e.action&&(i="registrations");var a=e&&e.scope?"openid "+e.scope:"openid",u=n()+"/protocol/openid-connect/"+i+"?client_id="+encodeURIComponent(h.clientId)+"&redirect_uri="+encodeURIComponent(o)+"&state="+encodeURIComponent(r)+"&nonce="+encodeURIComponent(t)+"&response_mode="+encodeURIComponent(h.responseMode)+"&response_type="+encodeURIComponent(h.responseType)+"&scope="+encodeURIComponent(a);return e&&e.prompt&&(u+="&prompt="+encodeURIComponent(e.prompt)),e&&e.maxAge&&(u+="&max_age="+encodeURIComponent(e.maxAge)),e&&e.loginHint&&(u+="&login_hint="+encodeURIComponent(e.loginHint)),e&&e.idpHint&&(u+="&kc_idp_hint="+encodeURIComponent(e.idpHint)),e&&e.locale&&(u+="&ui_locales="+encodeURIComponent(e.locale)),u},h.logout=function(e){return p.logout(e)},h.createLogoutUrl=function(e){return n()+"/protocol/openid-connect/logout?redirect_uri="+encodeURIComponent(p.redirectUri(e,!1))},h.register=function(e){return p.register(e)},h.createRegisterUrl=function(e){return e||(e={}),e.action="register",h.createLoginUrl(e)},h.createAccountUrl=function(e){return n()+"/account?referrer="+encodeURIComponent(h.clientId)+"&referrer_uri="+encodeURIComponent(p.redirectUri(e))},h.accountManagement=function(){return p.accountManagement()},h.hasRealmRole=function(e){var r=h.realmAccess;return!!r&&r.roles.indexOf(e)>=0},h.hasResourceRole=function(e,r){if(!h.resourceAccess)return!1;var n=h.resourceAccess[r||h.clientId];return!!n&&n.roles.indexOf(e)>=0},h.loadUserProfile=function(){var e=n()+"/account",r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+h.token);var t=u();return r.onreadystatechange=function(){4==r.readyState&&(200==r.status?(h.profile=JSON.parse(r.responseText),t.setSuccess(h.profile)):t.setError())},r.send(),t.promise},h.loadUserInfo=function(){var e=n()+"/protocol/openid-connect/userinfo",r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+h.token);var t=u();return r.onreadystatechange=function(){4==r.readyState&&(200==r.status?(h.userInfo=JSON.parse(r.responseText),t.setSuccess(h.userInfo)):t.setError())},r.send(),t.promise},h.isTokenExpired=function(e){if(!h.tokenParsed||!h.refreshToken&&"implicit"!=h.flow)throw"Not authenticated";if(null==h.timeSkew)return console.info("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var r=h.tokenParsed.exp-Math.ceil((new Date).getTime()/1e3)+h.timeSkew;return e&&(r-=e),r<0},h.updateToken=function(e){var r=u();if(!h.refreshToken)return r.setError(),r.promise;e=e||5;var t=function(){var t=!1;if(-1==e?(t=!0,console.info("[KEYCLOAK] Refreshing token: forced refresh")):h.tokenParsed&&!h.isTokenExpired(e)||(t=!0,console.info("[KEYCLOAK] Refreshing token: token expired")),t){var o="grant_type=refresh_token&refresh_token="+h.refreshToken,i=n()+"/protocol/openid-connect/token";if(k.push(r),1==k.length){var c=new XMLHttpRequest;c.open("POST",i,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.withCredentials=!0,h.clientId&&h.clientSecret?c.setRequestHeader("Authorization","Basic "+btoa(h.clientId+":"+h.clientSecret)):o+="&client_id="+encodeURIComponent(h.clientId);var a=(new Date).getTime();c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status){console.info("[KEYCLOAK] Token refreshed"),a=(a+(new Date).getTime())/2;var e=JSON.parse(c.responseText);s(e.access_token,e.refresh_token,e.id_token,a),h.onAuthRefreshSuccess&&h.onAuthRefreshSuccess();for(r=k.pop();null!=r;r=k.pop())r.setSuccess(!0)}else{console.warn("[KEYCLOAK] Failed to refresh token"),h.onAuthRefreshError&&h.onAuthRefreshError();for(var r=k.pop();null!=r;r=k.pop())r.setError(!0)}},c.send(o)}}else r.setSuccess(!1)};if(g.enable){d().success(function(){t()}).error(function(){r.setError()})}else t();return r.promise},h.clearToken=function(){h.token&&(s(null,null,null),h.onAuthLogout&&h.onAuthLogout(),h.loginRequired&&h.login())},h.callback_id=0;var w=function(){function e(){for(var e=(new Date).getTime(),r=0;r<localStorage.length;r++){var n=localStorage.key(r);if(n&&0==n.indexOf("kc-callback-")){var t=localStorage.getItem(n);if(t)try{var o=JSON.parse(t).expires;(!o||o<e)&&localStorage.removeItem(n)}catch(e){localStorage.removeItem(n)}}}}if(!(this instanceof w))return new w;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");this.get=function(r){if(r){var n="kc-callback-"+r,t=localStorage.getItem(n);return t&&(localStorage.removeItem(n),t=JSON.parse(t)),e(),t}},this.add=function(r){e();var n="kc-callback-"+r.state;r.expires=(new Date).getTime()+36e5,localStorage.setItem(n,JSON.stringify(r))}},b=function(){if(!(this instanceof b))return new b;this.get=function(t){if(t){var o=r("kc-callback-"+t);return n("kc-callback-"+t,"",e(-100)),o?JSON.parse(o):void 0}},this.add=function(r){n("kc-callback-"+r.state,JSON.stringify(r),e(60))},this.removeItem=function(r){n(r,"",e(-100))};var e=function(e){var r=new Date;return r.setTime(r.getTime()+60*e*1e3),r},r=function(e){for(var r=e+"=",n=document.cookie.split(";"),t=0;t<n.length;t++){for(var o=n[t];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(r))return o.substring(r.length,o.length)}return""},n=function(e,r,n){var t=e+"="+r+"; expires="+n.toUTCString()+"; ";document.cookie=t}},T=function(e,r){if(!(this instanceof T))return new T(e,r);var n=function(e){for(var r={},n=e.split("&"),t=0;t<n.length;t++){var o=n[t].split("="),s=decodeURIComponent(o[0]),i=decodeURIComponent(o[1]);r[s]=i}return r},t=function(e,r,n){for(var t=["code","state","error","error_description"],o=0;o<t.length;o++)if(e===t[o])return n[e]=r,!0;return!1};this.parseUri=function(){var o=function(){var r=null,n=null,t=null,o=e.indexOf("?"),s=e.indexOf("#",o+1);return-1==o&&-1==s?r=e:-1!=o?(r=e.substring(0,o),n=e.substring(o+1),-1!=s&&(s=n.indexOf("#"),t=n.substring(s+1),n=n.substring(0,s))):(r=e.substring(0,s),t=e.substring(s+1)),{baseUri:r,queryString:n,fragmentString:t}}(),s={};o.queryString&&(s=n(o.queryString));var i={newUrl:o.baseUri};for(var c in s)switch(c){case"redirect_fragment":i.fragment=s[c];break;default:"query"==r&&t(c,s[c],i)||(i.newUrl+=(-1==i.newUrl.indexOf("?")?"?":"&")+c+"="+encodeURIComponent(s[c]))}if("fragment"===r){var a={};o.fragmentString&&(a=n(o.fragmentString));for(var c in a)i[c]=a[c]}return i}}};e?e.exports=t:r.Keycloak=t}(window)}),r=!1,n=function(){};return n.install=function(n,t){function o(e){void 0===e&&(e=!1),i.authenticated=e,e&&(i.token=s.token,i.resourceAccess=s.resourceAccess,s.loadUserProfile().success(function(e){i.user=e}))}if(void 0===t&&(t={keycloakOptions:{},keycloakInitOptions:{},refreshTime:10}),!r){r=!0;var s=e(t.keycloakOptions),i=new n({data:function(){return{ready:!1,authenticated:!1,user:null,token:null,resourceAccess:null}}});s.init(t.keycloakInitOptions).success(function(e){i.ready=!0,o(e),e&&setTimeout(function(){s.updateToken(t.refreshTime+2).success(function(e){e&&o(!0)})},1e3*t.refreshTime)}),Object.defineProperty(n.prototype,"$keycloak",{get:function(){return s.ready=i.ready,s.user=i.user,s}})}},n.version="0.0.8",n});